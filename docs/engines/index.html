<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Getting Started with Engines · Rails Setup</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;In this guide you will learn about engines and how they can be used to provide&lt;/p&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Getting Started with Engines · Rails Setup"/><meta property="og:type" content="website"/><meta property="og:url" content="https://HenryTabima.github.io/rails-setup/"/><meta property="og:description" content="&lt;p&gt;In this guide you will learn about engines and how they can be used to provide&lt;/p&gt;
"/><meta property="og:image" content="https://HenryTabima.github.io/rails-setup/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://HenryTabima.github.io/rails-setup/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/rails-setup/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/rails-setup/js/scrollSpy.js"></script><link rel="stylesheet" href="/rails-setup/css/main.css"/><script src="/rails-setup/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/rails-setup/"><img class="logo" src="/rails-setup/img/favicon.ico" alt="Rails Setup"/><h2 class="headerTitleWithLogo">Rails Setup</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/rails-setup/docs/getting started" target="_self">Rails Docs</a></li><li class=""><a href="https://github.com/HenryTabima/rails-setup" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Digging Deeper</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Start Here</h3><ul class=""><li class="navListItem"><a class="navItem" href="/rails-setup/docs/getting started">Getting Started with Rails</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/development dependencies install">Development Dependencies Install</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Models</h3><ul class=""><li class="navListItem"><a class="navItem" href="/rails-setup/docs/active record basics">Active Record Basics</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/active record migrations">Active Record Migrations</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/active record validations">Active Record Validations</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/active record callbacks">Active Record Callbacks</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/active record associations">Active Record Associations</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/active record query">Active Record Query Interface</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/multiple databases">Multiple Databases with Active Record</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/active record postgresql">Active Record and PostgreSQL</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Views</h3><ul class=""><li class="navListItem"><a class="navItem" href="/rails-setup/docs/layouts and rendering">Layouts and Rendering in Rails</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/action view">Action View Overview</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/action view form helpers">Action View Form Helpers</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Controllers</h3><ul class=""><li class="navListItem"><a class="navItem" href="/rails-setup/docs/action controller">Action Controller Overview</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails routing">Rails Routing from the Outside In</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Other Components</h3><ul class=""><li class="navListItem"><a class="navItem" href="/rails-setup/docs/active support core">Active Support Core Extensions</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/active support instrumentation">Active Support Instrumentation</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/action mailer">Action Mailer Basics</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/action mailbox">Action Mailbox Basics</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/active model">Active Model Basics</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/active job">Active Job Basics</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/action text">Action Text Overview</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/active storage">Active Storage Overview</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/action cable">Action Cable Overview</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Digging Deeper</h3><ul class=""><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails i18n">Rails Internationalization (I18n) API</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/testing rails">Testing Rails Applications</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/securing rails">Securing Rails Applications</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/debugging rails">Debugging Rails Applications</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/configuring rails">Configuring Rails Applications</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails command line">The Rails Command Line</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/asset pipeline">The Asset Pipeline</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/working with javascript">Working with JavaScript in Rails</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/autoloading and reloading">Autoloading and Reloading Constants</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/caching with rails">Caching with Rails: An Overview</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/api only apps">Using Rails for API-only Applications</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/threading">Threading and Code Execution in Rails</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/initialization">The Rails Initialization Process</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/rails-setup/docs/engines">Getting Started with Engines</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Extending Rails</h3><ul class=""><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails on rack">Rails on Rack</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/generators &amp; templates">Creating and Customizing Rails Generators &amp; Templates</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/application templates">Rails Application Templates</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/creating rails plugins">The Basics of Creating Rails Plugins</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Contributions</h3><ul class=""><li class="navListItem"><a class="navItem" href="/rails-setup/docs/contributing to rails">Contributing to Ruby on Rails</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/api documentation">API Documentation Guidelines</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/guides guidelines">Ruby on Rails Guides Guidelines</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Policies</h3><ul class=""><li class="navListItem"><a class="navItem" href="/rails-setup/docs/maintenance policy">Maintenance Policy for Ruby on Rails</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Getting Started with Engines</h1></header><article><div><span><p>In this guide you will learn about engines and how they can be used to provide
additional functionality to their host applications through a clean and very
easy-to-use interface.</p>
<p>After reading this guide, you will know:</p>
<ul>
<li>What makes an engine.</li>
<li>How to generate an engine.</li>
<li>How to build features for the engine.</li>
<li>How to hook the engine into an application.</li>
<li>How to override engine functionality in the application.</li>
<li>Avoid loading Rails frameworks with Load and Configuration Hooks</li>
</ul>
<hr>
<h2><a class="anchor" aria-hidden="true" id="what-are-engines"></a><a href="#what-are-engines" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What are engines?</h2>
<p>Engines can be considered miniature applications that provide functionality to
their host applications. A Rails application is actually just a &quot;supercharged&quot;
engine, with the <code>Rails::Application</code> class inheriting a lot of its behavior
from <code>Rails::Engine</code>.</p>
<p>Therefore, engines and applications can be thought of as almost the same thing,
just with subtle differences, as you'll see throughout this guide. Engines and
applications also share a common structure.</p>
<p>Engines are also closely related to plugins. The two share a common <code>lib</code>
directory structure, and are both generated using the <code>rails plugin new</code>
generator. The difference is that an engine is considered a &quot;full plugin&quot; by
Rails (as indicated by the <code>--full</code> option that's passed to the generator
command). We'll actually be using the <code>--mountable</code> option here, which includes
all the features of <code>--full</code>, and then some. This guide will refer to these
&quot;full plugins&quot; simply as &quot;engines&quot; throughout. An engine <strong>can</strong> be a plugin,
and a plugin <strong>can</strong> be an engine.</p>
<p>The engine that will be created in this guide will be called &quot;blorgh&quot;. This
engine will provide blogging functionality to its host applications, allowing
for new articles and comments to be created. At the beginning of this guide, you
will be working solely within the engine itself, but in later sections you'll
see how to hook it into an application.</p>
<p>Engines can also be isolated from their host applications. This means that an
application is able to have a path provided by a routing helper such as
<code>articles_path</code> and use an engine that also provides a path also called
<code>articles_path</code>, and the two would not clash. Along with this, controllers, models
and table names are also namespaced. You'll see how to do this later in this
guide.</p>
<p>It's important to keep in mind at all times that the application should
<strong>always</strong> take precedence over its engines. An application is the object that
has final say in what goes on in its environment. The engine should
only be enhancing it, rather than changing it drastically.</p>
<p>To see demonstrations of other engines, check out
<a href="https://github.com/plataformatec/devise">Devise</a>, an engine that provides
authentication for its parent applications, or
<a href="https://github.com/thredded/thredded">Thredded</a>, an engine that provides forum
functionality. There's also <a href="https://github.com/spree/spree">Spree</a> which
provides an e-commerce platform, and
<a href="https://github.com/refinery/refinerycms">Refinery CMS</a>, a CMS engine.</p>
<p>Finally, engines would not have been possible without the work of James Adam,
Piotr Sarnacki, the Rails Core Team, and a number of other people. If you ever
meet them, don't forget to say thanks!</p>
<h2><a class="anchor" aria-hidden="true" id="generating-an-engine"></a><a href="#generating-an-engine" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Generating an engine</h2>
<p>To generate an engine, you will need to run the plugin generator and pass it
options as appropriate to the need. For the &quot;blorgh&quot; example, you will need to
create a &quot;mountable&quot; engine, running this command in a terminal:</p>
<pre><code class="hljs css language-bash">$ rails plugin new blorgh --mountable
</code></pre>
<p>The full list of options for the plugin generator may be seen by typing:</p>
<pre><code class="hljs css language-bash">$ rails plugin --<span class="hljs-built_in">help</span>
</code></pre>
<p>The <code>--mountable</code> option tells the generator that you want to create a
&quot;mountable&quot; and namespace-isolated engine. This generator will provide the same
skeleton structure as would the <code>--full</code> option. The <code>--full</code> option tells the
generator that you want to create an engine, including a skeleton structure
that provides the following:</p>
<ul>
<li><p>An <code>app</code> directory tree</p></li>
<li><p>A <code>config/routes.rb</code> file:</p>
<pre><code class="hljs css language-ruby">Rails.application.routes.draw <span class="hljs-keyword">do</span>
<span class="hljs-keyword">end</span>
</code></pre></li>
<li><p>A file at <code>lib/blorgh/engine.rb</code>, which is identical in function to a
standard Rails application's <code>config/application.rb</code> file:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">Blorgh</span></span>
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Engine</span> &lt; ::<span class="hljs-title">Rails::Engine</span></span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre></li>
</ul>
<p>The <code>--mountable</code> option will add to the <code>--full</code> option:</p>
<ul>
<li><p>Asset manifest files (<code>application.js</code> and <code>application.css</code>)</p></li>
<li><p>A namespaced <code>ApplicationController</code> stub</p></li>
<li><p>A namespaced <code>ApplicationHelper</code> stub</p></li>
<li><p>A layout view template for the engine</p></li>
<li><p>Namespace isolation to <code>config/routes.rb</code>:</p>
<pre><code class="hljs css language-ruby">Blorgh::Engine.routes.draw <span class="hljs-keyword">do</span>
<span class="hljs-keyword">end</span>
</code></pre></li>
<li><p>Namespace isolation to <code>lib/blorgh/engine.rb</code>:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">Blorgh</span></span>
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Engine</span> &lt; ::<span class="hljs-title">Rails::Engine</span></span>
    isolate_namespace Blorgh
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre></li>
</ul>
<p>Additionally, the <code>--mountable</code> option tells the generator to mount the engine
inside the dummy testing application located at <code>test/dummy</code> by adding the
following to the dummy application's routes file at
<code>test/dummy/config/routes.rb</code>:</p>
<pre><code class="hljs css language-ruby">mount Blorgh::Engine =&gt; <span class="hljs-string">"/blorgh"</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="inside-an-engine"></a><a href="#inside-an-engine" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Inside an Engine</h3>
<h4><a class="anchor" aria-hidden="true" id="critical-files"></a><a href="#critical-files" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Critical Files</h4>
<p>At the root of this brand new engine's directory lives a <code>blorgh.gemspec</code> file.
When you include the engine into an application later on, you will do so with
this line in the Rails application's <code>Gemfile</code>:</p>
<pre><code class="hljs css language-ruby">gem <span class="hljs-string">'blorgh'</span>, <span class="hljs-symbol">path:</span> <span class="hljs-string">'engines/blorgh'</span>
</code></pre>
<p>Don't forget to run <code>bundle install</code> as usual. By specifying it as a gem within
the <code>Gemfile</code>, Bundler will load it as such, parsing this <code>blorgh.gemspec</code> file
and requiring a file within the <code>lib</code> directory called <code>lib/blorgh.rb</code>. This
file requires the <code>blorgh/engine.rb</code> file (located at <code>lib/blorgh/engine.rb</code>)
and defines a base module called <code>Blorgh</code>.</p>
<pre><code class="hljs css language-ruby"><span class="hljs-keyword">require</span> <span class="hljs-string">"blorgh/engine"</span>

<span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">Blorgh</span></span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>TIP: Some engines choose to use this file to put global configuration options
for their engine. It's a relatively good idea, so if you want to offer
configuration options, the file where your engine's <code>module</code> is defined is
perfect for that. Place the methods inside the module and you'll be good to go.</p>
<p>Within <code>lib/blorgh/engine.rb</code> is the base class for the engine:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">Blorgh</span></span>
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Engine</span> &lt; ::<span class="hljs-title">Rails::Engine</span></span>
    isolate_namespace Blorgh
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>By inheriting from the <code>Rails::Engine</code> class, this gem notifies Rails that
there's an engine at the specified path, and will correctly mount the engine
inside the application, performing tasks such as adding the <code>app</code> directory of
the engine to the load path for models, mailers, controllers, and views.</p>
<p>The <code>isolate_namespace</code> method here deserves special notice. This call is
responsible for isolating the controllers, models, routes, and other things into
their own namespace, away from similar components inside the application.
Without this, there is a possibility that the engine's components could &quot;leak&quot;
into the application, causing unwanted disruption, or that important engine
components could be overridden by similarly named things within the application.
One of the examples of such conflicts is helpers. Without calling
<code>isolate_namespace</code>, the engine's helpers would be included in an application's
controllers.</p>
<p>NOTE: It is <strong>highly</strong> recommended that the <code>isolate_namespace</code> line be left
within the <code>Engine</code> class definition. Without it, classes generated in an engine
<strong>may</strong> conflict with an application.</p>
<p>What this isolation of the namespace means is that a model generated by a call
to <code>rails g model</code>, such as <code>rails g model article</code>, won't be called <code>Article</code>, but
instead be namespaced and called <code>Blorgh::Article</code>. In addition, the table for the
model is namespaced, becoming <code>blorgh_articles</code>, rather than simply <code>articles</code>.
Similar to the model namespacing, a controller called <code>ArticlesController</code> becomes
<code>Blorgh::ArticlesController</code> and the views for that controller will not be at
<code>app/views/articles</code>, but <code>app/views/blorgh/articles</code> instead. Mailers are namespaced
as well.</p>
<p>Finally, routes will also be isolated within the engine. This is one of the most
important parts about namespacing, and is discussed later in the
<a href="#routes">Routes</a> section of this guide.</p>
<h4><a class="anchor" aria-hidden="true" id="app-directory"></a><a href="#app-directory" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>app</code> Directory</h4>
<p>Inside the <code>app</code> directory are the standard <code>assets</code>, <code>controllers</code>, <code>helpers</code>,
<code>jobs</code>, <code>mailers</code>, <code>models</code>, and <code>views</code> directories that you should be familiar with
from an application. We'll look more into models in a future section, when we're writing the engine.</p>
<p>Within the <code>app/assets</code> directory, there are the <code>images</code>, <code>javascripts</code> and
<code>stylesheets</code> directories which, again, you should be familiar with due to their
similarity to an application. One difference here, however, is that each
directory contains a sub-directory with the engine name. Because this engine is
going to be namespaced, its assets should be too.</p>
<p>Within the <code>app/controllers</code> directory there is a <code>blorgh</code> directory that
contains a file called <code>application_controller.rb</code>. This file will provide any
common functionality for the controllers of the engine. The <code>blorgh</code> directory
is where the other controllers for the engine will go. By placing them within
this namespaced directory, you prevent them from possibly clashing with
identically-named controllers within other engines or even within the
application.</p>
<p>NOTE: The <code>ApplicationController</code> class inside an engine is named just like a
Rails application in order to make it easier for you to convert your
applications into engines.</p>
<p>NOTE: Because of the way that Ruby does constant lookup you may run into a situation
where your engine controller is inheriting from the main application controller and
not your engine's application controller. Ruby is able to resolve the <code>ApplicationController</code> constant, and therefore the autoloading mechanism is not triggered. See the section <a href="autoloading_and_reloading_constants.html#when-constants-aren-t-missed">When Constants Aren't Missed</a> of the <a href="autoloading_and_reloading_constants.html">Autoloading and Reloading Constants</a> guide for further details. The best way to prevent this from
happening is to use <code>require_dependency</code> to ensure that the engine's application
controller is loaded. For example:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-comment"># app/controllers/blorgh/articles_controller.rb:</span>
require_dependency <span class="hljs-string">"blorgh/application_controller"</span>

<span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">Blorgh</span></span>
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ArticlesController</span> &lt; ApplicationController</span>
    ...
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>WARNING: Don't use <code>require</code> because it will break the automatic reloading of classes
in the development environment - using <code>require_dependency</code> ensures that classes are
loaded and unloaded in the correct manner.</p>
<p>Within the <code>app/helpers</code> directory there is a <code>blorgh</code> directory that
contains a file called <code>application_helper.rb</code>. This file will provide any
common functionality for the helpers of the engine. The <code>blorgh</code> directory
is where the other helpers for the engine will go. By placing them within
this namespaced directory, you prevent them from possibly clashing with
identically-named helpers within other engines or even within the
application.</p>
<p>Within the <code>app/jobs</code> directory there is a <code>blorgh</code> directory that
contains a file called <code>application_job.rb</code>. This file will provide any
common functionality for the jobs of the engine. The <code>blorgh</code> directory
is where the other jobs for the engine will go. By placing them within
this namespaced directory, you prevent them from possibly clashing with
identically-named jobs within other engines or even within the
application.</p>
<p>Within the <code>app/mailers</code> directory there is a <code>blorgh</code> directory that
contains a file called <code>application_mailer.rb</code>. This file will provide any
common functionality for the mailers of the engine. The <code>blorgh</code> directory
is where the other mailers for the engine will go. By placing them within
this namespaced directory, you prevent them from possibly clashing with
identically-named mailers within other engines or even within the
application.</p>
<p>Lastly, the <code>app/views</code> directory contains a <code>layouts</code> folder, which contains a
file at <code>blorgh/application.html.erb</code>. This file allows you to specify a layout
for the engine. If this engine is to be used as a stand-alone engine, then you
would add any customization to its layout in this file, rather than the
application's <code>app/views/layouts/application.html.erb</code> file.</p>
<p>If you don't want to force a layout on to users of the engine, then you can
delete this file and reference a different layout in the controllers of your
engine.</p>
<h4><a class="anchor" aria-hidden="true" id="bin-directory"></a><a href="#bin-directory" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>bin</code> Directory</h4>
<p>This directory contains one file, <code>bin/rails</code>, which enables you to use the
<code>rails</code> sub-commands and generators just like you would within an application.
This means that you will be able to generate new controllers and models for this
engine very easily by running commands like this:</p>
<pre><code class="hljs css language-bash">$ bin/rails g model
</code></pre>
<p>Keep in mind, of course, that anything generated with these commands inside of
an engine that has <code>isolate_namespace</code> in the <code>Engine</code> class will be namespaced.</p>
<h4><a class="anchor" aria-hidden="true" id="test-directory"></a><a href="#test-directory" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>test</code> Directory</h4>
<p>The <code>test</code> directory is where tests for the engine will go. To test the engine,
there is a cut-down version of a Rails application embedded within it at
<code>test/dummy</code>. This application will mount the engine in the
<code>test/dummy/config/routes.rb</code> file:</p>
<pre><code class="hljs css language-ruby">Rails.application.routes.draw <span class="hljs-keyword">do</span>
  mount Blorgh::Engine =&gt; <span class="hljs-string">"/blorgh"</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>This line mounts the engine at the path <code>/blorgh</code>, which will make it accessible
through the application only at that path.</p>
<p>Inside the test directory there is the <code>test/integration</code> directory, where
integration tests for the engine should be placed. Other directories can be
created in the <code>test</code> directory as well. For example, you may wish to create a
<code>test/models</code> directory for your model tests.</p>
<h2><a class="anchor" aria-hidden="true" id="providing-engine-functionality"></a><a href="#providing-engine-functionality" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Providing engine functionality</h2>
<p>The engine that this guide covers provides submitting articles and commenting
functionality and follows a similar thread to the <a href="getting_started.html">Getting Started
Guide</a>, with some new twists.</p>
<p>NOTE: For this section, make sure to run the commands in the root of the
<code>blorgh</code> engine's directory.</p>
<h3><a class="anchor" aria-hidden="true" id="generating-an-article-resource"></a><a href="#generating-an-article-resource" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Generating an Article Resource</h3>
<p>The first thing to generate for a blog engine is the <code>Article</code> model and related
controller. To quickly generate this, you can use the Rails scaffold generator.</p>
<pre><code class="hljs css language-bash">$ rails generate scaffold article title:string text:text
</code></pre>
<p>This command will output this information:</p>
<pre><code class="hljs">invoke  active_record
create    db/migrate/[timestamp]_create_blorgh_articles.rb
create    app/models/blorgh/article.rb<span class="hljs-built_in">
invoke </span>   test_unit
create      test/models/blorgh/article_test.rb
create      test/fixtures/blorgh/articles.yml<span class="hljs-built_in">
invoke </span> resource_route
 route    resources<span class="hljs-keyword"> :articles</span><span class="hljs-built_in">
invoke </span> scaffold_controller
create    app/controllers/blorgh/articles_controller.rb<span class="hljs-built_in">
invoke </span>   erb
create      app/views/blorgh/articles
create      app/views/blorgh/articles/index.html.erb
create      app/views/blorgh/articles/edit.html.erb
create      app/views/blorgh/articles/show.html.erb
create      app/views/blorgh/articles/new.html.erb
create      app/views/blorgh/articles/_form.html.erb<span class="hljs-built_in">
invoke </span>   test_unit
create      test/controllers/blorgh/articles_controller_test.rb
create      test/system/blorgh/articles_test.rb<span class="hljs-built_in">
invoke </span>   helper
create      app/helpers/blorgh/articles_helper.rb<span class="hljs-built_in">
invoke </span>     test_unit<span class="hljs-built_in">
invoke </span> assets<span class="hljs-built_in">
invoke </span>   css
create      app/assets/stylesheets/blorgh/articles.css<span class="hljs-built_in">
invoke </span> css
create    app/assets/stylesheets/scaffold.css
</code></pre>
<p>The first thing that the scaffold generator does is invoke the <code>active_record</code>
generator, which generates a migration and a model for the resource. Note here,
however, that the migration is called <code>create_blorgh_articles</code> rather than the
usual <code>create_articles</code>. This is due to the <code>isolate_namespace</code> method called in
the <code>Blorgh::Engine</code> class's definition. The model here is also namespaced,
being placed at <code>app/models/blorgh/article.rb</code> rather than <code>app/models/article.rb</code> due
to the <code>isolate_namespace</code> call within the <code>Engine</code> class.</p>
<p>Next, the <code>test_unit</code> generator is invoked for this model, generating a model
test at <code>test/models/blorgh/article_test.rb</code> (rather than
<code>test/models/article_test.rb</code>) and a fixture at <code>test/fixtures/blorgh/articles.yml</code>
(rather than <code>test/fixtures/articles.yml</code>).</p>
<p>After that, a line for the resource is inserted into the <code>config/routes.rb</code> file
for the engine. This line is simply <code>resources :articles</code>, turning the
<code>config/routes.rb</code> file for the engine into this:</p>
<pre><code class="hljs css language-ruby">Blorgh::Engine.routes.draw <span class="hljs-keyword">do</span>
  resources <span class="hljs-symbol">:articles</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>Note here that the routes are drawn upon the <code>Blorgh::Engine</code> object rather than
the <code>YourApp::Application</code> class. This is so that the engine routes are confined
to the engine itself and can be mounted at a specific point as shown in the
<a href="#test-directory">test directory</a> section. It also causes the engine's routes to
be isolated from those routes that are within the application. The
<a href="#routes">Routes</a> section of this guide describes it in detail.</p>
<p>Next, the <code>scaffold_controller</code> generator is invoked, generating a controller
called <code>Blorgh::ArticlesController</code> (at
<code>app/controllers/blorgh/articles_controller.rb</code>) and its related views at
<code>app/views/blorgh/articles</code>. This generator also generates tests for the
controller (<code>test/controllers/blorgh/articles_controller_test.rb</code> and <code>test/system/blorgh/articles_test.rb</code>) and a helper (<code>app/helpers/blorgh/articles_helper.rb</code>).</p>
<p>Everything this generator has created is neatly namespaced. The controller's
class is defined within the <code>Blorgh</code> module:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">Blorgh</span></span>
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ArticlesController</span> &lt; ApplicationController</span>
    ...
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>NOTE: The <code>ArticlesController</code> class inherits from
<code>Blorgh::ApplicationController</code>, not the application's <code>ApplicationController</code>.</p>
<p>The helper inside <code>app/helpers/blorgh/articles_helper.rb</code> is also namespaced:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">Blorgh</span></span>
  <span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">ArticlesHelper</span></span>
    ...
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>This helps prevent conflicts with any other engine or application that may have
an article resource as well.</p>
<p>Finally, the assets for this resource are generated in one file: <code>app/assets/stylesheets/blorgh/articles.css</code>. You'll see how to use these a little later.</p>
<p>You can see what the engine has so far by running <code>rails db:migrate</code> at the root
of our engine to run the migration generated by the scaffold generator, and then
running <code>rails server</code> in <code>test/dummy</code>. When you open
<code>http://localhost:3000/blorgh/articles</code> you will see the default scaffold that has
been generated. Click around! You've just generated your first engine's first
functions.</p>
<p>If you'd rather play around in the console, <code>rails console</code> will also work just
like a Rails application. Remember: the <code>Article</code> model is namespaced, so to
reference it you must call it as <code>Blorgh::Article</code>.</p>
<pre><code class="hljs css language-ruby"><span class="hljs-meta">&gt;&gt;</span> Blorgh::Article.find(<span class="hljs-number">1</span>)
=&gt; #&lt;Blorgh::Article id: 1 ...&gt;
</code></pre>
<p>One final thing is that the <code>articles</code> resource for this engine should be the root
of the engine. Whenever someone goes to the root path where the engine is
mounted, they should be shown a list of articles. This can be made to happen if
this line is inserted into the <code>config/routes.rb</code> file inside the engine:</p>
<pre><code class="hljs css language-ruby">root <span class="hljs-symbol">to:</span> <span class="hljs-string">"articles#index"</span>
</code></pre>
<p>Now people will only need to go to the root of the engine to see all the articles,
rather than visiting <code>/articles</code>. This means that instead of
<code>http://localhost:3000/blorgh/articles</code>, you only need to go to
<code>http://localhost:3000/blorgh</code> now.</p>
<h3><a class="anchor" aria-hidden="true" id="generating-a-comments-resource"></a><a href="#generating-a-comments-resource" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Generating a Comments Resource</h3>
<p>Now that the engine can create new articles, it only makes sense to add
commenting functionality as well. To do this, you'll need to generate a comment
model, a comment controller, and then modify the articles scaffold to display
comments and allow people to create new ones.</p>
<p>From the application root, run the model generator. Tell it to generate a
<code>Comment</code> model, with the related table having two columns: an <code>article_id</code> integer
and <code>text</code> text column.</p>
<pre><code class="hljs css language-bash">$ rails generate model Comment article_id:<span class="hljs-built_in">integer</span> text:text
</code></pre>
<p>This will output the following:</p>
<pre><code class="hljs">invoke  active_record
create    db/migrate/[timestamp]_create_blorgh_comments.rb
create    app/models/blorgh/comment.rb<span class="hljs-built_in">
invoke </span>   test_unit
create      test/models/blorgh/comment_test.rb
create      test/fixtures/blorgh/comments.yml
</code></pre>
<p>This generator call will generate just the necessary model files it needs,
namespacing the files under a <code>blorgh</code> directory and creating a model class
called <code>Blorgh::Comment</code>. Now run the migration to create our blorgh_comments
table:</p>
<pre><code class="hljs css language-bash">$ rails db:migrate
</code></pre>
<p>To show the comments on an article, edit <code>app/views/blorgh/articles/show.html.erb</code> and
add this line before the &quot;Edit&quot; link:</p>
<pre><code class="hljs css language-html+erb"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>Comments<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> render @article.comments </span><span class="xml"><span class="hljs-tag">%&gt;</span>
</span></code></pre>
<p>This line will require there to be a <code>has_many</code> association for comments defined
on the <code>Blorgh::Article</code> model, which there isn't right now. To define one, open
<code>app/models/blorgh/article.rb</code> and add this line into the model:</p>
<pre><code class="hljs css language-ruby">has_many <span class="hljs-symbol">:comments</span>
</code></pre>
<p>Turning the model into this:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">Blorgh</span></span>
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Article</span> &lt; ApplicationRecord</span>
    has_many <span class="hljs-symbol">:comments</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>NOTE: Because the <code>has_many</code> is defined inside a class that is inside the
<code>Blorgh</code> module, Rails will know that you want to use the <code>Blorgh::Comment</code>
model for these objects, so there's no need to specify that using the
<code>:class_name</code> option here.</p>
<p>Next, there needs to be a form so that comments can be created on an article. To
add this, put this line underneath the call to <code>render @article.comments</code> in
<code>app/views/blorgh/articles/show.html.erb</code>:</p>
<pre><code class="hljs css language-erb"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> render <span class="hljs-string">"blorgh/comments/form"</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
</span></code></pre>
<p>Next, the partial that this line will render needs to exist. Create a new
directory at <code>app/views/blorgh/comments</code> and in it a new file called
<code>_form.html.erb</code> which has this content to create the required partial:</p>
<pre><code class="hljs css language-html+erb"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>New comment<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> form_with(<span class="hljs-symbol">model:</span> [@article, @article.comments.build], <span class="hljs-symbol">local:</span> <span class="hljs-literal">true</span>) <span class="hljs-keyword">do</span> <span class="hljs-params">|form|</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> form.label <span class="hljs-symbol">:text</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> form.text_area <span class="hljs-symbol">:text</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> form.submit </span><span class="xml"><span class="hljs-tag">%&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="ruby"> <span class="hljs-keyword">end</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
</span></code></pre>
<p>When this form is submitted, it is going to attempt to perform a <code>POST</code> request
to a route of <code>/articles/:article_id/comments</code> within the engine. This route doesn't
exist at the moment, but can be created by changing the <code>resources :articles</code> line
inside <code>config/routes.rb</code> into these lines:</p>
<pre><code class="hljs css language-ruby">resources <span class="hljs-symbol">:articles</span> <span class="hljs-keyword">do</span>
  resources <span class="hljs-symbol">:comments</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>This creates a nested route for the comments, which is what the form requires.</p>
<p>The route now exists, but the controller that this route goes to does not. To
create it, run this command from the application root:</p>
<pre><code class="hljs css language-bash">$ rails g controller comments
</code></pre>
<p>This will generate the following things:</p>
<pre><code class="hljs">create  app/controllers/blorgh/comments_controller.rb<span class="hljs-built_in">
invoke </span> erb
 exist    app/views/blorgh/comments<span class="hljs-built_in">
invoke </span> test_unit
create    test/controllers/blorgh/comments_controller_test.rb<span class="hljs-built_in">
invoke </span> helper
create    app/helpers/blorgh/comments_helper.rb<span class="hljs-built_in">
invoke </span>   test_unit<span class="hljs-built_in">
invoke </span> assets<span class="hljs-built_in">
invoke </span>   css
create      app/assets/stylesheets/blorgh/comments.css
</code></pre>
<p>The form will be making a <code>POST</code> request to <code>/articles/:article_id/comments</code>, which
will correspond with the <code>create</code> action in <code>Blorgh::CommentsController</code>. This
action needs to be created, which can be done by putting the following lines
inside the class definition in <code>app/controllers/blorgh/comments_controller.rb</code>:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create</span></span>
  @article = Article.find(params[<span class="hljs-symbol">:article_id</span>])
  @comment = @article.comments.create(comment_params)
  flash[<span class="hljs-symbol">:notice</span>] = <span class="hljs-string">"Comment has been created!"</span>
  redirect_to articles_path
<span class="hljs-keyword">end</span>

private
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">comment_params</span></span>
    params.<span class="hljs-keyword">require</span>(<span class="hljs-symbol">:comment</span>).permit(<span class="hljs-symbol">:text</span>)
  <span class="hljs-keyword">end</span>
</code></pre>
<p>This is the final step required to get the new comment form working. Displaying
the comments, however, is not quite right yet. If you were to create a comment
right now, you would see this error:</p>
<pre><code class="hljs">Missing partial blorgh/comments/_comment <span class="hljs-keyword">with</span> {<span class="hljs-symbol">:handlers=&gt;</span>[<span class="hljs-symbol">:erb</span>, <span class="hljs-symbol">:builder</span>],
<span class="hljs-symbol">:formats=&gt;</span>[<span class="hljs-symbol">:html</span>], <span class="hljs-symbol">:locale=&gt;</span>[<span class="hljs-symbol">:en</span>, <span class="hljs-symbol">:en</span>]}. Searched <span class="hljs-symbol">in:</span>   *
<span class="hljs-string">"/Users/ryan/Sites/side_projects/blorgh/test/dummy/app/views"</span>   *
<span class="hljs-string">"/Users/ryan/Sites/side_projects/blorgh/app/views"</span>
</code></pre>
<p>The engine is unable to find the partial required for rendering the comments.
Rails looks first in the application's (<code>test/dummy</code>) <code>app/views</code> directory and
then in the engine's <code>app/views</code> directory. When it can't find it, it will throw
this error. The engine knows to look for <code>blorgh/comments/_comment</code> because the
model object it is receiving is from the <code>Blorgh::Comment</code> class.</p>
<p>This partial will be responsible for rendering just the comment text, for now.
Create a new file at <code>app/views/blorgh/comments/_comment.html.erb</code> and put this
line inside it:</p>
<pre><code class="hljs css language-erb"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> comment_counter + <span class="hljs-number">1</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>. <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> comment.text </span><span class="xml"><span class="hljs-tag">%&gt;</span>
</span></code></pre>
<p>The <code>comment_counter</code> local variable is given to us by the <code>&lt;%= render @article.comments %&gt;</code> call, which will define it automatically and increment the
counter as it iterates through each comment. It's used in this example to
display a small number next to each comment when it's created.</p>
<p>That completes the comment function of the blogging engine. Now it's time to use
it within an application.</p>
<h2><a class="anchor" aria-hidden="true" id="hooking-into-an-application"></a><a href="#hooking-into-an-application" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Hooking Into an Application</h2>
<p>Using an engine within an application is very easy. This section covers how to
mount the engine into an application and the initial setup required, as well as
linking the engine to a <code>User</code> class provided by the application to provide
ownership for articles and comments within the engine.</p>
<h3><a class="anchor" aria-hidden="true" id="mounting-the-engine"></a><a href="#mounting-the-engine" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mounting the Engine</h3>
<p>First, the engine needs to be specified inside the application's <code>Gemfile</code>. If
there isn't an application handy to test this out in, generate one using the
<code>rails new</code> command outside of the engine directory like this:</p>
<pre><code class="hljs css language-bash">$ rails new unicorn
</code></pre>
<p>Usually, specifying the engine inside the <code>Gemfile</code> would be done by specifying it
as a normal, everyday gem.</p>
<pre><code class="hljs css language-ruby">gem <span class="hljs-string">'devise'</span>
</code></pre>
<p>However, because you are developing the <code>blorgh</code> engine on your local machine,
you will need to specify the <code>:path</code> option in your <code>Gemfile</code>:</p>
<pre><code class="hljs css language-ruby">gem <span class="hljs-string">'blorgh'</span>, <span class="hljs-symbol">path:</span> <span class="hljs-string">'engines/blorgh'</span>
</code></pre>
<p>Then run <code>bundle</code> to install the gem.</p>
<p>As described earlier, by placing the gem in the <code>Gemfile</code> it will be loaded when
Rails is loaded. It will first require <code>lib/blorgh.rb</code> from the engine, then
<code>lib/blorgh/engine.rb</code>, which is the file that defines the major pieces of
functionality for the engine.</p>
<p>To make the engine's functionality accessible from within an application, it
needs to be mounted in that application's <code>config/routes.rb</code> file:</p>
<pre><code class="hljs css language-ruby">mount Blorgh::Engine, <span class="hljs-symbol">at:</span> <span class="hljs-string">"/blog"</span>
</code></pre>
<p>This line will mount the engine at <code>/blog</code> in the application. Making it
accessible at <code>http://localhost:3000/blog</code> when the application runs with <code>rails server</code>.</p>
<p>NOTE: Other engines, such as Devise, handle this a little differently by making
you specify custom helpers (such as <code>devise_for</code>) in the routes. These helpers
do exactly the same thing, mounting pieces of the engines's functionality at a
pre-defined path which may be customizable.</p>
<h3><a class="anchor" aria-hidden="true" id="engine-setup"></a><a href="#engine-setup" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Engine setup</h3>
<p>The engine contains migrations for the <code>blorgh_articles</code> and <code>blorgh_comments</code>
table which need to be created in the application's database so that the
engine's models can query them correctly. To copy these migrations into the
application run the following command from the application's root:</p>
<pre><code class="hljs css language-bash">$ rails blorgh:install:migrations
</code></pre>
<p>If you have multiple engines that need migrations copied over, use
<code>railties:install:migrations</code> instead:</p>
<pre><code class="hljs css language-bash">$ rails railties:install:migrations
</code></pre>
<p>This command, when run for the first time, will copy over all the migrations
from the engine. When run the next time, it will only copy over migrations that
haven't been copied over already. The first run for this command will output
something such as this:</p>
<pre><code class="hljs css language-bash">Copied migration [timestamp_1]_create_blorgh_articles.blorgh.rb from blorgh
Copied migration [timestamp_2]_create_blorgh_comments.blorgh.rb from blorgh
</code></pre>
<p>The first timestamp (<code>[timestamp_1]</code>) will be the current time, and the second
timestamp (<code>[timestamp_2]</code>) will be the current time plus a second. The reason
for this is so that the migrations for the engine are run after any existing
migrations in the application.</p>
<p>To run these migrations within the context of the application, simply run <code>rails db:migrate</code>. When accessing the engine through <code>http://localhost:3000/blog</code>, the
articles will be empty. This is because the table created inside the application is
different from the one created within the engine. Go ahead, play around with the
newly mounted engine. You'll find that it's the same as when it was only an
engine.</p>
<p>If you would like to run migrations only from one engine, you can do it by
specifying <code>SCOPE</code>:</p>
<pre><code class="hljs css language-bash">rails db:migrate SCOPE=blorgh
</code></pre>
<p>This may be useful if you want to revert engine's migrations before removing it.
To revert all migrations from blorgh engine you can run code such as:</p>
<pre><code class="hljs css language-bash">rails db:migrate SCOPE=blorgh VERSION=0
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="using-a-class-provided-by-the-application"></a><a href="#using-a-class-provided-by-the-application" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using a Class Provided by the Application</h3>
<h4><a class="anchor" aria-hidden="true" id="using-a-model-provided-by-the-application"></a><a href="#using-a-model-provided-by-the-application" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using a Model Provided by the Application</h4>
<p>When an engine is created, it may want to use specific classes from an
application to provide links between the pieces of the engine and the pieces of
the application. In the case of the <code>blorgh</code> engine, making articles and comments
have authors would make a lot of sense.</p>
<p>A typical application might have a <code>User</code> class that would be used to represent
authors for an article or a comment. But there could be a case where the
application calls this class something different, such as <code>Person</code>. For this
reason, the engine should not hardcode associations specifically for a <code>User</code>
class.</p>
<p>To keep it simple in this case, the application will have a class called <code>User</code>
that represents the users of the application (we'll get into making this
configurable further on). It can be generated using this command inside the
application:</p>
<pre><code class="hljs css language-bash">rails g model user name:string
</code></pre>
<p>The <code>rails db:migrate</code> command needs to be run here to ensure that our
application has the <code>users</code> table for future use.</p>
<p>Also, to keep it simple, the articles form will have a new text field called
<code>author_name</code>, where users can elect to put their name. The engine will then
take this name and either create a new <code>User</code> object from it, or find one that
already has that name. The engine will then associate the article with the found or
created <code>User</code> object.</p>
<p>First, the <code>author_name</code> text field needs to be added to the
<code>app/views/blorgh/articles/_form.html.erb</code> partial inside the engine. This can be
added above the <code>title</code> field with this code:</p>
<pre><code class="hljs css language-html+erb"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"field"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> form.label <span class="hljs-symbol">:author_name</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> form.text_field <span class="hljs-symbol">:author_name</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</span></code></pre>
<p>Next, we need to update our <code>Blorgh::ArticleController#article_params</code> method to
permit the new form parameter:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">article_params</span></span>
  params.<span class="hljs-keyword">require</span>(<span class="hljs-symbol">:article</span>).permit(<span class="hljs-symbol">:title</span>, <span class="hljs-symbol">:text</span>, <span class="hljs-symbol">:author_name</span>)
<span class="hljs-keyword">end</span>
</code></pre>
<p>The <code>Blorgh::Article</code> model should then have some code to convert the <code>author_name</code>
field into an actual <code>User</code> object and associate it as that article's <code>author</code>
before the article is saved. It will also need to have an <code>attr_accessor</code> set up
for this field, so that the setter and getter methods are defined for it.</p>
<p>To do all this, you'll need to add the <code>attr_accessor</code> for <code>author_name</code>, the
association for the author and the <code>before_validation</code> call into
<code>app/models/blorgh/article.rb</code>. The <code>author</code> association will be hard-coded to the
<code>User</code> class for the time being.</p>
<pre><code class="hljs css language-ruby"><span class="hljs-keyword">attr_accessor</span> <span class="hljs-symbol">:author_name</span>
belongs_to <span class="hljs-symbol">:author</span>, <span class="hljs-symbol">class_name:</span> <span class="hljs-string">"User"</span>

before_validation <span class="hljs-symbol">:set_author</span>

private
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">set_author</span></span>
    <span class="hljs-keyword">self</span>.author = User.find_or_create_by(<span class="hljs-symbol">name:</span> author_name)
  <span class="hljs-keyword">end</span>
</code></pre>
<p>By representing the <code>author</code> association's object with the <code>User</code> class, a link
is established between the engine and the application. There needs to be a way
of associating the records in the <code>blorgh_articles</code> table with the records in the
<code>users</code> table. Because the association is called <code>author</code>, there should be an
<code>author_id</code> column added to the <code>blorgh_articles</code> table.</p>
<p>To generate this new column, run this command within the engine:</p>
<pre><code class="hljs css language-bash">$ rails g migration add_author_id_to_blorgh_articles author_id:<span class="hljs-built_in">integer</span>
</code></pre>
<p>NOTE: Due to the migration's name and the column specification after it, Rails
will automatically know that you want to add a column to a specific table and
write that into the migration for you. You don't need to tell it any more than
this.</p>
<p>This migration will need to be run on the application. To do that, it must first
be copied using this command:</p>
<pre><code class="hljs css language-bash">$ rails blorgh:install:migrations
</code></pre>
<p>Notice that only <em>one</em> migration was copied over here. This is because the first
two migrations were copied over the first time this command was run.</p>
<pre><code class="hljs">NOTE Migration [timestamp]_create_blorgh_articles.blorgh.rb <span class="hljs-keyword">from</span> blorgh has been skipped. Migration with the same name already exists.<span class="hljs-built_in">
NOTE </span>Migration [timestamp]_create_blorgh_comments.blorgh.rb <span class="hljs-keyword">from</span> blorgh has been skipped. Migration with the same name already exists.
Copied migration [timestamp]_add_author_id_to_blorgh_articles.blorgh.rb <span class="hljs-keyword">from</span> blorgh
</code></pre>
<p>Run the migration using:</p>
<pre><code class="hljs css language-bash">$ rails db:migrate
</code></pre>
<p>Now with all the pieces in place, an action will take place that will associate
an author - represented by a record in the <code>users</code> table - with an article,
represented by the <code>blorgh_articles</code> table from the engine.</p>
<p>Finally, the author's name should be displayed on the article's page. Add this code
above the &quot;Title&quot; output inside <code>app/views/blorgh/articles/show.html.erb</code>:</p>
<pre><code class="hljs css language-html+erb"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>Author:<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> @article.author.name </span><span class="xml"><span class="hljs-tag">%&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
</span></code></pre>
<h4><a class="anchor" aria-hidden="true" id="using-a-controller-provided-by-the-application"></a><a href="#using-a-controller-provided-by-the-application" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using a Controller Provided by the Application</h4>
<p>Because Rails controllers generally share code for things like authentication
and accessing session variables, they inherit from <code>ApplicationController</code> by
default. Rails engines, however are scoped to run independently from the main
application, so each engine gets a scoped <code>ApplicationController</code>. This
namespace prevents code collisions, but often engine controllers need to access
methods in the main application's <code>ApplicationController</code>. An easy way to
provide this access is to change the engine's scoped <code>ApplicationController</code> to
inherit from the main application's <code>ApplicationController</code>. For our Blorgh
engine this would be done by changing
<code>app/controllers/blorgh/application_controller.rb</code> to look like:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">Blorgh</span></span>
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationController</span> &lt; ::<span class="hljs-title">ApplicationController</span></span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>By default, the engine's controllers inherit from
<code>Blorgh::ApplicationController</code>. So, after making this change they will have
access to the main application's <code>ApplicationController</code>, as though they were
part of the main application.</p>
<p>This change does require that the engine is run from a Rails application that
has an <code>ApplicationController</code>.</p>
<h3><a class="anchor" aria-hidden="true" id="configuring-an-engine"></a><a href="#configuring-an-engine" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuring an Engine</h3>
<p>This section covers how to make the <code>User</code> class configurable, followed by
general configuration tips for the engine.</p>
<h4><a class="anchor" aria-hidden="true" id="setting-configuration-settings-in-the-application"></a><a href="#setting-configuration-settings-in-the-application" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setting Configuration Settings in the Application</h4>
<p>The next step is to make the class that represents a <code>User</code> in the application
customizable for the engine. This is because that class may not always be
<code>User</code>, as previously explained. To make this setting customizable, the engine
will have a configuration setting called <code>author_class</code> that will be used to
specify which class represents users inside the application.</p>
<p>To define this configuration setting, you should use a <code>mattr_accessor</code> inside
the <code>Blorgh</code> module for the engine. Add this line to <code>lib/blorgh.rb</code> inside the
engine:</p>
<pre><code class="hljs css language-ruby">mattr_accessor <span class="hljs-symbol">:author_class</span>
</code></pre>
<p>This method works like its siblings, <code>attr_accessor</code> and <code>cattr_accessor</code>, but
provides a setter and getter method on the module with the specified name. To
use it, it must be referenced using <code>Blorgh.author_class</code>.</p>
<p>The next step is to switch the <code>Blorgh::Article</code> model over to this new setting.
Change the <code>belongs_to</code> association inside this model
(<code>app/models/blorgh/article.rb</code>) to this:</p>
<pre><code class="hljs css language-ruby">belongs_to <span class="hljs-symbol">:author</span>, <span class="hljs-symbol">class_name:</span> Blorgh.author_class
</code></pre>
<p>The <code>set_author</code> method in the <code>Blorgh::Article</code> model should also use this class:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-keyword">self</span>.author = Blorgh.author_class.constantize.find_or_create_by(<span class="hljs-symbol">name:</span> author_name)
</code></pre>
<p>To save having to call <code>constantize</code> on the <code>author_class</code> result all the time,
you could instead just override the <code>author_class</code> getter method inside the
<code>Blorgh</code> module in the <code>lib/blorgh.rb</code> file to always call <code>constantize</code> on the
saved value before returning the result:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">self</span>.<span class="hljs-title">author_class</span></span>
  @@author_class.constantize
<span class="hljs-keyword">end</span>
</code></pre>
<p>This would then turn the above code for <code>set_author</code> into this:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-keyword">self</span>.author = Blorgh.author_class.find_or_create_by(<span class="hljs-symbol">name:</span> author_name)
</code></pre>
<p>Resulting in something a little shorter, and more implicit in its behavior. The
<code>author_class</code> method should always return a <code>Class</code> object.</p>
<p>Since we changed the <code>author_class</code> method to return a <code>Class</code> instead of a
<code>String</code>, we must also modify our <code>belongs_to</code> definition in the <code>Blorgh::Article</code>
model:</p>
<pre><code class="hljs css language-ruby">belongs_to <span class="hljs-symbol">:author</span>, <span class="hljs-symbol">class_name:</span> Blorgh.author_class.to_s
</code></pre>
<p>To set this configuration setting within the application, an initializer should
be used. By using an initializer, the configuration will be set up before the
application starts and calls the engine's models, which may depend on this
configuration setting existing.</p>
<p>Create a new initializer at <code>config/initializers/blorgh.rb</code> inside the
application where the <code>blorgh</code> engine is installed and put this content in it:</p>
<pre><code class="hljs css language-ruby">Blorgh.author_class = <span class="hljs-string">"User"</span>
</code></pre>
<p>WARNING: It's very important here to use the <code>String</code> version of the class,
rather than the class itself. If you were to use the class, Rails would attempt
to load that class and then reference the related table. This could lead to
problems if the table didn't already exist. Therefore, a <code>String</code> should be
used and then converted to a class using <code>constantize</code> in the engine later on.</p>
<p>Go ahead and try to create a new article. You will see that it works exactly in the
same way as before, except this time the engine is using the configuration
setting in <code>config/initializers/blorgh.rb</code> to learn what the class is.</p>
<p>There are now no strict dependencies on what the class is, only what the API for
the class must be. The engine simply requires this class to define a
<code>find_or_create_by</code> method which returns an object of that class, to be
associated with an article when it's created. This object, of course, should have
some sort of identifier by which it can be referenced.</p>
<h4><a class="anchor" aria-hidden="true" id="general-engine-configuration"></a><a href="#general-engine-configuration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>General Engine Configuration</h4>
<p>Within an engine, there may come a time where you wish to use things such as
initializers, internationalization, or other configuration options. The great
news is that these things are entirely possible, because a Rails engine shares
much the same functionality as a Rails application. In fact, a Rails
application's functionality is actually a superset of what is provided by
engines!</p>
<p>If you wish to use an initializer - code that should run before the engine is
loaded - the place for it is the <code>config/initializers</code> folder. This directory's
functionality is explained in the <a href="configuring.html#initializers">Initializers
section</a> of the Configuring guide, and works
precisely the same way as the <code>config/initializers</code> directory inside an
application. The same thing goes if you want to use a standard initializer.</p>
<p>For locales, simply place the locale files in the <code>config/locales</code> directory,
just like you would in an application.</p>
<h2><a class="anchor" aria-hidden="true" id="testing-an-engine"></a><a href="#testing-an-engine" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Testing an engine</h2>
<p>When an engine is generated, there is a smaller dummy application created inside
it at <code>test/dummy</code>. This application is used as a mounting point for the engine,
to make testing the engine extremely simple. You may extend this application by
generating controllers, models, or views from within the directory, and then use
those to test your engine.</p>
<p>The <code>test</code> directory should be treated like a typical Rails testing environment,
allowing for unit, functional, and integration tests.</p>
<h3><a class="anchor" aria-hidden="true" id="functional-tests"></a><a href="#functional-tests" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Functional Tests</h3>
<p>A matter worth taking into consideration when writing functional tests is that
the tests are going to be running on an application - the <code>test/dummy</code>
application - rather than your engine. This is due to the setup of the testing
environment; an engine needs an application as a host for testing its main
functionality, especially controllers. This means that if you were to make a
typical <code>GET</code> to a controller in a controller's functional test like this:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">Blorgh</span></span>
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FooControllerTest</span> &lt; ActionDispatch::IntegrationTest</span>
    <span class="hljs-keyword">include</span> Engine.routes.url_helpers

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_index</span></span>
      get foos_url
      ...
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>It may not function correctly. This is because the application doesn't know how
to route these requests to the engine unless you explicitly tell it <strong>how</strong>. To
do this, you must set the <code>@routes</code> instance variable to the engine's route set
in your setup code:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">Blorgh</span></span>
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FooControllerTest</span> &lt; ActionDispatch::IntegrationTest</span>
    <span class="hljs-keyword">include</span> Engine.routes.url_helpers

    setup <span class="hljs-keyword">do</span>
      @routes = Engine.routes
    <span class="hljs-keyword">end</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_index</span></span>
      get foos_url
      ...
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>This tells the application that you still want to perform a <code>GET</code> request to the
<code>index</code> action of this controller, but you want to use the engine's route to get
there, rather than the application's one.</p>
<p>This also ensures that the engine's URL helpers will work as expected in your
tests.</p>
<h2><a class="anchor" aria-hidden="true" id="improving-engine-functionality"></a><a href="#improving-engine-functionality" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Improving engine functionality</h2>
<p>This section explains how to add and/or override engine MVC functionality in the
main Rails application.</p>
<h3><a class="anchor" aria-hidden="true" id="overriding-models-and-controllers"></a><a href="#overriding-models-and-controllers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Overriding Models and Controllers</h3>
<p>Engine model and controller classes can be extended by open classing them in the
main Rails application (since model and controller classes are just Ruby classes
that inherit Rails specific functionality). Open classing an Engine class
redefines it for use in the main application.</p>
<p>For simple class modifications, use <code>Class#class_eval</code>. For complex class
modifications, consider using <code>ActiveSupport::Concern</code>.</p>
<h4><a class="anchor" aria-hidden="true" id="a-note-on-overriding-and-loading-code"></a><a href="#a-note-on-overriding-and-loading-code" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A note on Overriding and Loading Code</h4>
<p>Because these overrides are not referenced by your Rails application itself,
Rails' autoloading system will not kick in and load your overrides. This means
that you need to require them yourself.</p>
<p>Here is some sample code to do this:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-comment"># lib/blorgh/engine.rb</span>
<span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">Blorgh</span></span>
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Engine</span> &lt; ::<span class="hljs-title">Rails::Engine</span></span>
    isolate_namespace Blorgh

    config.to_prepare <span class="hljs-keyword">do</span>
      Dir.glob(Rails.root + <span class="hljs-string">"app/overrides/**/*_override*.rb"</span>).each <span class="hljs-keyword">do</span> <span class="hljs-params">|c|</span>
        require_dependency(c)
      <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>This doesn't apply to just overrides, but anything that you add in an engine
that isn't referenced by your main application.</p>
<h4><a class="anchor" aria-hidden="true" id="reopening-existing-classes-using-class-class_eval"></a><a href="#reopening-existing-classes-using-class-class_eval" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Reopening existing classes using Class#class_eval</h4>
<p><strong>Adding</strong> <code>Article#time_since_created</code>:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-comment"># MyApp/app/overrides/models/blorgh/article_override.rb</span>

Blorgh::Article.class_eval <span class="hljs-keyword">do</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">time_since_created</span></span>
    Time.current - created_at
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<pre><code class="hljs css language-ruby"><span class="hljs-comment"># Blorgh/app/models/blorgh/article.rb</span>
<span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">Blorgh</span></span>
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Article</span> &lt; ApplicationRecord</span>
    has_many <span class="hljs-symbol">:comments</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p><strong>Overriding</strong> <code>Article#summary</code>:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-comment"># MyApp/app/overrides/models/blorgh/article_override.rb</span>

Blorgh::Article.class_eval <span class="hljs-keyword">do</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">summary</span></span>
    <span class="hljs-string">"<span class="hljs-subst">#{title}</span> - <span class="hljs-subst">#{truncate(text)}</span>"</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<pre><code class="hljs css language-ruby"><span class="hljs-comment"># Blorgh/app/models/blorgh/article.rb</span>
<span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">Blorgh</span></span>
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Article</span> &lt; ApplicationRecord</span>
    has_many <span class="hljs-symbol">:comments</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">summary</span></span>
      <span class="hljs-string">"<span class="hljs-subst">#{title}</span>"</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="reopening-existing-classes-using-activesupport-concern"></a><a href="#reopening-existing-classes-using-activesupport-concern" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Reopening existing classes using ActiveSupport::Concern</h4>
<p>Using <code>Class#class_eval</code> is great for simple adjustments, but for more complex
class modifications, you might want to consider using [<code>ActiveSupport::Concern</code>]
(<a href="https://api.rubyonrails.org/classes/ActiveSupport/Concern.html">https://api.rubyonrails.org/classes/ActiveSupport/Concern.html</a>).
ActiveSupport::Concern manages load order of interlinked dependent modules and
classes at run time allowing you to significantly modularize your code.</p>
<p><strong>Adding</strong> <code>Article#time_since_created</code> and <strong>Overriding</strong> <code>Article#summary</code>:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-comment"># MyApp/app/models/blorgh/article.rb</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Blorgh::Article</span> &lt; ApplicationRecord</span>
  <span class="hljs-keyword">include</span> Blorgh::Concerns::Models::Article

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">time_since_created</span></span>
    Time.current - created_at
  <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">summary</span></span>
    <span class="hljs-string">"<span class="hljs-subst">#{title}</span> - <span class="hljs-subst">#{truncate(text)}</span>"</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<pre><code class="hljs css language-ruby"><span class="hljs-comment"># Blorgh/app/models/blorgh/article.rb</span>
<span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">Blorgh</span></span>
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Article</span> &lt; ApplicationRecord</span>
    <span class="hljs-keyword">include</span> Blorgh::Concerns::Models::Article
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<pre><code class="hljs css language-ruby"><span class="hljs-comment"># Blorgh/lib/concerns/models/article.rb</span>

<span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">Blorgh::Concerns::Models::Article</span></span>
  extend ActiveSupport::Concern

  <span class="hljs-comment"># 'included do' causes the included code to be evaluated in the</span>
  <span class="hljs-comment"># context where it is included (article.rb), rather than being</span>
  <span class="hljs-comment"># executed in the module's context (blorgh/concerns/models/article).</span>
  included <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">attr_accessor</span> <span class="hljs-symbol">:author_name</span>
    belongs_to <span class="hljs-symbol">:author</span>, <span class="hljs-symbol">class_name:</span> <span class="hljs-string">"User"</span>

    before_validation <span class="hljs-symbol">:set_author</span>

    private
      <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">set_author</span></span>
        <span class="hljs-keyword">self</span>.author = User.find_or_create_by(<span class="hljs-symbol">name:</span> author_name)
      <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">summary</span></span>
    <span class="hljs-string">"<span class="hljs-subst">#{title}</span>"</span>
  <span class="hljs-keyword">end</span>

  <span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">ClassMethods</span></span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">some_class_method</span></span>
      <span class="hljs-string">'some class method string'</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="overriding-views"></a><a href="#overriding-views" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Overriding Views</h3>
<p>When Rails looks for a view to render, it will first look in the <code>app/views</code>
directory of the application. If it cannot find the view there, it will check in
the <code>app/views</code> directories of all engines that have this directory.</p>
<p>When the application is asked to render the view for <code>Blorgh::ArticlesController</code>'s
index action, it will first look for the path
<code>app/views/blorgh/articles/index.html.erb</code> within the application. If it cannot
find it, it will look inside the engine.</p>
<p>You can override this view in the application by simply creating a new file at
<code>app/views/blorgh/articles/index.html.erb</code>. Then you can completely change what
this view would normally output.</p>
<p>Try this now by creating a new file at <code>app/views/blorgh/articles/index.html.erb</code>
and put this content in it:</p>
<pre><code class="hljs css language-html+erb"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Articles<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">"New Article"</span>, new_article_path </span><span class="xml"><span class="hljs-tag">%&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="ruby"> @articles.each <span class="hljs-keyword">do</span> <span class="hljs-params">|article|</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> article.title </span><span class="xml"><span class="hljs-tag">%&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">small</span>&gt;</span>By <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> article.author </span><span class="xml"><span class="hljs-tag">%&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> simple_format(article.text) </span><span class="xml"><span class="hljs-tag">%&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">hr</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="ruby"> <span class="hljs-keyword">end</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
</span></code></pre>
<h3><a class="anchor" aria-hidden="true" id="routes"></a><a href="#routes" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Routes</h3>
<p>Routes inside an engine are isolated from the application by default. This is
done by the <code>isolate_namespace</code> call inside the <code>Engine</code> class. This essentially
means that the application and its engines can have identically named routes and
they will not clash.</p>
<p>Routes inside an engine are drawn on the <code>Engine</code> class within
<code>config/routes.rb</code>, like this:</p>
<pre><code class="hljs css language-ruby">Blorgh::Engine.routes.draw <span class="hljs-keyword">do</span>
  resources <span class="hljs-symbol">:articles</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>By having isolated routes such as this, if you wish to link to an area of an
engine from within an application, you will need to use the engine's routing
proxy method. Calls to normal routing methods such as <code>articles_path</code> may end up
going to undesired locations if both the application and the engine have such a
helper defined.</p>
<p>For instance, the following example would go to the application's <code>articles_path</code>
if that template was rendered from the application, or the engine's <code>articles_path</code>
if it was rendered from the engine:</p>
<pre><code class="hljs css language-erb"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">"Blog articles"</span>, articles_path </span><span class="xml"><span class="hljs-tag">%&gt;</span>
</span></code></pre>
<p>To make this route always use the engine's <code>articles_path</code> routing helper method,
we must call the method on the routing proxy method that shares the same name as
the engine.</p>
<pre><code class="hljs css language-erb"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">"Blog articles"</span>, blorgh.articles_path </span><span class="xml"><span class="hljs-tag">%&gt;</span>
</span></code></pre>
<p>If you wish to reference the application inside the engine in a similar way, use
the <code>main_app</code> helper:</p>
<pre><code class="hljs css language-erb"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> link_to <span class="hljs-string">"Home"</span>, main_app.root_path </span><span class="xml"><span class="hljs-tag">%&gt;</span>
</span></code></pre>
<p>If you were to use this inside an engine, it would <strong>always</strong> go to the
application's root. If you were to leave off the <code>main_app</code> &quot;routing proxy&quot;
method call, it could potentially go to the engine's or application's root,
depending on where it was called from.</p>
<p>If a template rendered from within an engine attempts to use one of the
application's routing helper methods, it may result in an undefined method call.
If you encounter such an issue, ensure that you're not attempting to call the
application's routing methods without the <code>main_app</code> prefix from within the
engine.</p>
<h3><a class="anchor" aria-hidden="true" id="assets"></a><a href="#assets" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Assets</h3>
<p>Assets within an engine work in an identical way to a full application. Because
the engine class inherits from <code>Rails::Engine</code>, the application will know to
look up assets in the engine's <code>app/assets</code> and <code>lib/assets</code> directories.</p>
<p>Like all of the other components of an engine, the assets should be namespaced.
This means that if you have an asset called <code>style.css</code>, it should be placed at
<code>app/assets/stylesheets/[engine name]/style.css</code>, rather than
<code>app/assets/stylesheets/style.css</code>. If this asset isn't namespaced, there is a
possibility that the host application could have an asset named identically, in
which case the application's asset would take precedence and the engine's one
would be ignored.</p>
<p>Imagine that you did have an asset located at
<code>app/assets/stylesheets/blorgh/style.css</code> To include this asset inside an
application, just use <code>stylesheet_link_tag</code> and reference the asset as if it
were inside the engine:</p>
<pre><code class="hljs css language-erb"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> stylesheet_link_tag <span class="hljs-string">"blorgh/style.css"</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
</span></code></pre>
<p>You can also specify these assets as dependencies of other assets using Asset
Pipeline require statements in processed files:</p>
<pre><code class="hljs"><span class="hljs-comment">/*
 *= require blorgh/style
*/</span>
</code></pre>
<p>INFO. Remember that in order to use languages like Sass or CoffeeScript, you
should add the relevant library to your engine's <code>.gemspec</code>.</p>
<h3><a class="anchor" aria-hidden="true" id="separate-assets-precompiling"></a><a href="#separate-assets-precompiling" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Separate Assets &amp; Precompiling</h3>
<p>There are some situations where your engine's assets are not required by the
host application. For example, say that you've created an admin functionality
that only exists for your engine. In this case, the host application doesn't
need to require <code>admin.css</code> or <code>admin.js</code>. Only the gem's admin layout needs
these assets. It doesn't make sense for the host app to include
<code>&quot;blorgh/admin.css&quot;</code> in its stylesheets. In this situation, you should
explicitly define these assets for precompilation.  This tells Sprockets to add
your engine assets when <code>rails assets:precompile</code> is triggered.</p>
<p>You can define assets for precompilation in <code>engine.rb</code>:</p>
<pre><code class="hljs css language-ruby">initializer <span class="hljs-string">"blorgh.assets.precompile"</span> <span class="hljs-keyword">do</span> <span class="hljs-params">|app|</span>
  app.config.assets.precompile += <span class="hljs-string">%w( admin.js admin.css )</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>For more information, read the <a href="asset_pipeline.html">Asset Pipeline guide</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="other-gem-dependencies"></a><a href="#other-gem-dependencies" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Other Gem Dependencies</h3>
<p>Gem dependencies inside an engine should be specified inside the <code>.gemspec</code> file
at the root of the engine. The reason is that the engine may be installed as a
gem. If dependencies were to be specified inside the <code>Gemfile</code>, these would not
be recognized by a traditional gem install and so they would not be installed,
causing the engine to malfunction.</p>
<p>To specify a dependency that should be installed with the engine during a
traditional <code>gem install</code>, specify it inside the <code>Gem::Specification</code> block
inside the <code>.gemspec</code> file in the engine:</p>
<pre><code class="hljs css language-ruby">s.add_dependency <span class="hljs-string">"moo"</span>
</code></pre>
<p>To specify a dependency that should only be installed as a development
dependency of the application, specify it like this:</p>
<pre><code class="hljs css language-ruby">s.add_development_dependency <span class="hljs-string">"moo"</span>
</code></pre>
<p>Both kinds of dependencies will be installed when <code>bundle install</code> is run inside
of the application. The development dependencies for the gem will only be used
when the development and tests for the engine are running.</p>
<p>Note that if you want to immediately require dependencies when the engine is
required, you should require them before the engine's initialization. For
example:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-keyword">require</span> <span class="hljs-string">'other_engine/engine'</span>
<span class="hljs-keyword">require</span> <span class="hljs-string">'yet_another_engine/engine'</span>

<span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">MyEngine</span></span>
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Engine</span> &lt; ::<span class="hljs-title">Rails::Engine</span></span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="active-support-on-load-hooks"></a><a href="#active-support-on-load-hooks" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Active Support On Load Hooks</h2>
<p>Active Support is the Ruby on Rails component responsible for providing Ruby language extensions, utilities, and other transversal utilities.</p>
<p>Rails code can often be referenced on load of an application. Rails is responsible for the load order of these frameworks, so when you load frameworks, such as <code>ActiveRecord::Base</code>, prematurely you are violating an implicit contract your application has with Rails. Moreover, by loading code such as <code>ActiveRecord::Base</code> on boot of your application you are loading entire frameworks which may slow down your boot time and could cause conflicts with load order and boot of your application.</p>
<p>On Load hooks are the API that allow you to hook into this initialization process without violating the load contract with Rails. This will also mitigate boot performance degradation and avoid conflicts.</p>
<h2><a class="anchor" aria-hidden="true" id="what-are-on_load-hooks"></a><a href="#what-are-on_load-hooks" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What are <code>on_load</code> hooks?</h2>
<p>Since Ruby is a dynamic language, some code will cause different Rails frameworks to load. Take this snippet for instance:</p>
<pre><code class="hljs css language-ruby">ActiveRecord::Base.<span class="hljs-keyword">include</span>(MyActiveRecordHelper)
</code></pre>
<p>This snippet means that when this file is loaded, it will encounter <code>ActiveRecord::Base</code>. This encounter causes Ruby to look for the definition of that constant and will require it. This causes the entire Active Record framework to be loaded on boot.</p>
<p><code>ActiveSupport.on_load</code> is a mechanism that can be used to defer the loading of code until it is actually needed. The snippet above can be changed to:</p>
<pre><code class="hljs css language-ruby">ActiveSupport.on_load(<span class="hljs-symbol">:active_record</span>) { <span class="hljs-keyword">include</span> MyActiveRecordHelper }
</code></pre>
<p>This new snippet will only include <code>MyActiveRecordHelper</code> when <code>ActiveRecord::Base</code> is loaded.</p>
<h2><a class="anchor" aria-hidden="true" id="how-does-it-work"></a><a href="#how-does-it-work" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How does it work?</h2>
<p>In the Rails framework these hooks are called when a specific library is loaded. For example, when <code>ActionController::Base</code> is loaded, the <code>:action_controller_base</code> hook is called. This means that all <code>ActiveSupport.on_load</code> calls with <code>:action_controller_base</code> hooks will be called in the context of <code>ActionController::Base</code> (that means <code>self</code> will be an <code>ActionController::Base</code>).</p>
<h2><a class="anchor" aria-hidden="true" id="modifying-code-to-use-on_load-hooks"></a><a href="#modifying-code-to-use-on_load-hooks" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Modifying code to use <code>on_load</code> hooks</h2>
<p>Modifying code is generally straightforward. If you have a line of code that refers to a Rails framework such as <code>ActiveRecord::Base</code> you can wrap that code in an <code>on_load</code> hook.</p>
<h3><a class="anchor" aria-hidden="true" id="example-1"></a><a href="#example-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example 1</h3>
<pre><code class="hljs css language-ruby">ActiveRecord::Base.<span class="hljs-keyword">include</span>(MyActiveRecordHelper)
</code></pre>
<p>becomes</p>
<pre><code class="hljs css language-ruby">ActiveSupport.on_load(<span class="hljs-symbol">:active_record</span>) { <span class="hljs-keyword">include</span> MyActiveRecordHelper } <span class="hljs-comment"># self refers to ActiveRecord::Base here, so we can simply #include</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="example-2"></a><a href="#example-2" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example 2</h3>
<pre><code class="hljs css language-ruby">ActionController::Base.prepend(MyActionControllerHelper)
</code></pre>
<p>becomes</p>
<pre><code class="hljs css language-ruby">ActiveSupport.on_load(<span class="hljs-symbol">:action_controller_base</span>) { prepend MyActionControllerHelper } <span class="hljs-comment"># self refers to ActionController::Base here, so we can simply #prepend</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="example-3"></a><a href="#example-3" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example 3</h3>
<pre><code class="hljs css language-ruby">ActiveRecord::Base.include_root_in_json = <span class="hljs-literal">true</span>
</code></pre>
<p>becomes</p>
<pre><code class="hljs css language-ruby">ActiveSupport.on_load(<span class="hljs-symbol">:active_record</span>) { <span class="hljs-keyword">self</span>.include_root_in_json = <span class="hljs-literal">true</span> } <span class="hljs-comment"># self refers to ActiveRecord::Base here</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="available-hooks"></a><a href="#available-hooks" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Available Hooks</h2>
<p>These are the hooks you can use in your own code.</p>
<p>To hook into the initialization process of one of the following classes use the available hook.</p>
<table>
<thead>
<tr><th>Class</th><th>Available Hooks</th></tr>
</thead>
<tbody>
<tr><td><code>ActionCable</code></td><td><code>action_cable</code></td></tr>
<tr><td><code>ActionCable::Channel::Base</code></td><td><code>action_cable_channel</code></td></tr>
<tr><td><code>ActionCable::Connection::Base</code></td><td><code>action_cable_connection</code></td></tr>
<tr><td><code>ActionCable::Connection::TestCase</code></td><td><code>action_cable_connection_test_case</code></td></tr>
<tr><td><code>ActionController::API</code></td><td><code>action_controller_api</code></td></tr>
<tr><td><code>ActionController::API</code></td><td><code>action_controller</code></td></tr>
<tr><td><code>ActionController::Base</code></td><td><code>action_controller_base</code></td></tr>
<tr><td><code>ActionController::Base</code></td><td><code>action_controller</code></td></tr>
<tr><td><code>ActionController::TestCase</code></td><td><code>action_controller_test_case</code></td></tr>
<tr><td><code>ActionDispatch::IntegrationTest</code></td><td><code>action_dispatch_integration_test</code></td></tr>
<tr><td><code>ActionDispatch::SystemTestCase</code></td><td><code>action_dispatch_system_test_case</code></td></tr>
<tr><td><code>ActionMailbox::Base</code></td><td><code>action_mailbox</code></td></tr>
<tr><td><code>ActionMailbox::InboundEmail</code></td><td><code>action_mailbox_inbound_email</code></td></tr>
<tr><td><code>ActionMailbox::TestCase</code></td><td><code>action_mailbox_test_case</code></td></tr>
<tr><td><code>ActionMailer::Base</code></td><td><code>action_mailer</code></td></tr>
<tr><td><code>ActionMailer::TestCase</code></td><td><code>action_mailer_test_case</code></td></tr>
<tr><td><code>ActionText::Content</code></td><td><code>action_text_content</code></td></tr>
<tr><td><code>ActionText::RichText</code></td><td><code>action_text_rich_text</code></td></tr>
<tr><td><code>ActionView::Base</code></td><td><code>action_view</code></td></tr>
<tr><td><code>ActionView::TestCase</code></td><td><code>action_view_test_case</code></td></tr>
<tr><td><code>ActiveJob::Base</code></td><td><code>active_job</code></td></tr>
<tr><td><code>ActiveJob::TestCase</code></td><td><code>active_job_test_case</code></td></tr>
<tr><td><code>ActiveRecord::Base</code></td><td><code>active_record</code></td></tr>
<tr><td><code>ActiveStorage::Attachment</code></td><td><code>active_storage_attachment</code></td></tr>
<tr><td><code>ActiveStorage::Blob</code></td><td><code>active_storage_blob</code></td></tr>
<tr><td><code>ActiveSupport::TestCase</code></td><td><code>active_support_test_case</code></td></tr>
<tr><td><code>i18n</code></td><td><code>i18n</code></td></tr>
</tbody>
</table>
<h2><a class="anchor" aria-hidden="true" id="configuration-hooks"></a><a href="#configuration-hooks" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration hooks</h2>
<p>These are the available configuration hooks. They do not hook into any particular framework, but instead they run in context of the entire application.</p>
<table>
<thead>
<tr><th>Hook</th><th>Use Case</th></tr>
</thead>
<tbody>
<tr><td><code>before_configuration</code></td><td>First configurable block to run. Called before any initializers are run.</td></tr>
<tr><td><code>before_initialize</code></td><td>Second configurable block to run. Called before frameworks initialize.</td></tr>
<tr><td><code>before_eager_load</code></td><td>Third configurable block to run. Does not run if <code>config.eager_load</code> set to false.</td></tr>
<tr><td><code>after_initialize</code></td><td>Last configurable block to run. Called after frameworks initialize.</td></tr>
</tbody>
</table>
<h3><a class="anchor" aria-hidden="true" id="example"></a><a href="#example" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example</h3>
<pre><code class="hljs css language-ruby">config.before_configuration { puts <span class="hljs-string">'I am called before any initializers'</span> }
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/rails-setup/docs/initialization"><span class="arrow-prev">← </span><span>The Rails Initialization Process</span></a><a class="docs-next button" href="/rails-setup/docs/rails%20on%20rack"><span>Rails on Rack</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#what-are-engines">What are engines?</a></li><li><a href="#generating-an-engine">Generating an engine</a><ul class="toc-headings"><li><a href="#inside-an-engine">Inside an Engine</a></li></ul></li><li><a href="#providing-engine-functionality">Providing engine functionality</a><ul class="toc-headings"><li><a href="#generating-an-article-resource">Generating an Article Resource</a></li><li><a href="#generating-a-comments-resource">Generating a Comments Resource</a></li></ul></li><li><a href="#hooking-into-an-application">Hooking Into an Application</a><ul class="toc-headings"><li><a href="#mounting-the-engine">Mounting the Engine</a></li><li><a href="#engine-setup">Engine setup</a></li><li><a href="#using-a-class-provided-by-the-application">Using a Class Provided by the Application</a></li><li><a href="#configuring-an-engine">Configuring an Engine</a></li></ul></li><li><a href="#testing-an-engine">Testing an engine</a><ul class="toc-headings"><li><a href="#functional-tests">Functional Tests</a></li></ul></li><li><a href="#improving-engine-functionality">Improving engine functionality</a><ul class="toc-headings"><li><a href="#overriding-models-and-controllers">Overriding Models and Controllers</a></li><li><a href="#overriding-views">Overriding Views</a></li><li><a href="#routes">Routes</a></li><li><a href="#assets">Assets</a></li><li><a href="#separate-assets-precompiling">Separate Assets &amp; Precompiling</a></li><li><a href="#other-gem-dependencies">Other Gem Dependencies</a></li></ul></li><li><a href="#active-support-on-load-hooks">Active Support On Load Hooks</a></li><li><a href="#what-are-on_load-hooks">What are <code>on_load</code> hooks?</a></li><li><a href="#how-does-it-work">How does it work?</a></li><li><a href="#modifying-code-to-use-on_load-hooks">Modifying code to use <code>on_load</code> hooks</a><ul class="toc-headings"><li><a href="#example-1">Example 1</a></li><li><a href="#example-2">Example 2</a></li><li><a href="#example-3">Example 3</a></li></ul></li><li><a href="#available-hooks">Available Hooks</a></li><li><a href="#configuration-hooks">Configuration hooks</a><ul class="toc-headings"><li><a href="#example">Example</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="copyright">Copyright © 2019 Rails Setup</section></footer></div></body></html>