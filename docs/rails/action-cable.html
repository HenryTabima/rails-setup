<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Action Cable Overview · Rails Setup</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;In this guide, you will learn how Action Cable works and how to use WebSockets to&lt;/p&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Action Cable Overview · Rails Setup"/><meta property="og:type" content="website"/><meta property="og:url" content="https://HenryTabima.github.io/rails-setup/"/><meta property="og:description" content="&lt;p&gt;In this guide, you will learn how Action Cable works and how to use WebSockets to&lt;/p&gt;
"/><meta property="og:image" content="https://HenryTabima.github.io/rails-setup/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://HenryTabima.github.io/rails-setup/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/rails-setup/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/rails-setup/js/scrollSpy.js"></script><link rel="stylesheet" href="/rails-setup/css/main.css"/><script src="/rails-setup/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/rails-setup/"><img class="logo" src="/rails-setup/img/favicon.ico" alt="Rails Setup"/><h2 class="headerTitleWithLogo">Rails Setup</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/rails-setup/docs/rails/getting-started" target="_self">Rails</a></li><li class=""><a href="/rails-setup/docs/devise/overview" target="_self">Devise</a></li><li class=""><a href="https://github.com/HenryTabima/rails-setup" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Other Components</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Start Here<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/getting-started">Getting Started with Rails</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/development-dependencies-install">Development Dependencies Install</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Models<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/active-record-basics">Active Record Basics</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/active-record-migrations">Active Record Migrations</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/active-record-validations">Active Record Validations</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/active-record-callbacks">Active Record Callbacks</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/active-record-associations">Active Record Associations</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/active-record-query">Active Record Query Interface</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/multiple-databases">Multiple Databases with Active Record</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/active-record-postgresql">Active Record and PostgreSQL</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Views<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/layouts-and-rendering">Layouts and Rendering in Rails</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/action-view">Action View Overview</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/action-view-form-helpers">Action View Form Helpers</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Controllers<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/action-controller">Action Controller Overview</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/rails-routing">Rails Routing from the Outside In</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Other Components<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/active-support-core">Active Support Core Extensions</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/active-support-instrumentation">Active Support Instrumentation</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/action-mailer">Action Mailer Basics</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/action-mailbox">Action Mailbox Basics</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/active-model">Active Model Basics</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/active-job">Active Job Basics</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/action-text">Action Text Overview</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/active-storage">Active Storage Overview</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/rails-setup/docs/rails/action-cable">Action Cable Overview</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Digging Deeper<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/rails-i18n">Rails Internationalization (I18n) API</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/testing-rails">Testing Rails Applications</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/securing-rails">Securing Rails Applications</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/debugging-rails">Debugging Rails Applications</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/configuring-rails">Configuring Rails Applications</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/rails-command-line">The Rails Command Line</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/asset-pipeline">The Asset Pipeline</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/working-with-javascript">Working with JavaScript in Rails</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/autoloading-and-reloading">Autoloading and Reloading Constants</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/caching-with-rails">Caching with Rails: An Overview</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/api-only-apps">Using Rails for API-only Applications</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/threading">Threading and Code Execution in Rails</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/initialization">The Rails Initialization Process</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/engines">Getting Started with Engines</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Extending Rails<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/rails-on-rack">Rails on Rack</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/generators-&amp;-templates">Creating and Customizing Rails Generators &amp; Templates</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/application-templates">Rails Application Templates</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/creating-rails-plugins">The Basics of Creating Rails Plugins</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Contributions<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/contributing-to-rails">Contributing to Ruby on Rails</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/api-documentation">API Documentation Guidelines</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/guides-guidelines">Ruby on Rails Guides Guidelines</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Policies<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/maintenance-policy">Maintenance Policy for Ruby on Rails</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Action Cable Overview</h1></header><article><div><span><p>In this guide, you will learn how Action Cable works and how to use WebSockets to
incorporate real-time features into your Rails application.</p>
<p>After reading this guide, you will know:</p>
<ul>
<li>What Action Cable is and its integration backend and frontend</li>
<li>How to setup Action Cable</li>
<li>How to setup channels</li>
<li>Deployment and Architecture setup for running Action Cable</li>
</ul>
<hr>
<h2><a class="anchor" aria-hidden="true" id="introduction"></a><a href="#introduction" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Introduction</h2>
<p>Action Cable seamlessly integrates
<a href="https://en.wikipedia.org/wiki/WebSocket">WebSockets</a> with the rest of your
Rails application. It allows for real-time features to be written in Ruby in the
same style and form as the rest of your Rails application, while still being
performant and scalable. It's a full-stack offering that provides both a
client-side JavaScript framework and a server-side Ruby framework. You have
access to your full domain model written with Active Record or your ORM of
choice.</p>
<h2><a class="anchor" aria-hidden="true" id="terminology"></a><a href="#terminology" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Terminology</h2>
<p>A single Action Cable server can handle multiple connection instances. It has one
connection instance per WebSocket connection. A single user may have multiple
WebSockets open to your application if they use multiple browser tabs or devices.
The client of a WebSocket connection is called the consumer.</p>
<p>Each consumer can in turn subscribe to multiple cable channels. Each channel
encapsulates a logical unit of work, similar to what a controller does in
a regular MVC setup. For example, you could have a <code>ChatChannel</code> and
an <code>AppearancesChannel</code>, and a consumer could be subscribed to either
or to both of these channels. At the very least, a consumer should be subscribed
to one channel.</p>
<p>When the consumer is subscribed to a channel, they act as a subscriber.
The connection between the subscriber and the channel is, surprise-surprise,
called a subscription. A consumer can act as a subscriber to a given channel
any number of times. For example, a consumer could subscribe to multiple chat rooms
at the same time. (And remember that a physical user may have multiple consumers,
one per tab/device open to your connection).</p>
<p>Each channel can then again be streaming zero or more broadcastings.
A broadcasting is a pubsub link where anything transmitted by the broadcaster is
sent directly to the channel subscribers who are streaming that named broadcasting.</p>
<p>As you can see, this is a fairly deep architectural stack. There's a lot of new
terminology to identify the new pieces, and on top of that, you're dealing
with both client and server side reflections of each unit.</p>
<h2><a class="anchor" aria-hidden="true" id="what-is-pub-sub"></a><a href="#what-is-pub-sub" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What is Pub/Sub</h2>
<p><a href="https://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern">Pub/Sub</a>, or
Publish-Subscribe, refers to a message queue paradigm whereby senders of
information (publishers), send data to an abstract class of recipients
(subscribers), without specifying individual recipients. Action Cable uses this
approach to communicate between the server and many clients.</p>
<h2><a class="anchor" aria-hidden="true" id="server-side-components"></a><a href="#server-side-components" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Server-Side Components</h2>
<h3><a class="anchor" aria-hidden="true" id="connections"></a><a href="#connections" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Connections</h3>
<p><em>Connections</em> form the foundation of the client-server relationship. For every
WebSocket accepted by the server, a connection object is instantiated. This
object becomes the parent of all the <em>channel subscriptions</em> that are created
from there on. The connection itself does not deal with any specific application
logic beyond authentication and authorization. The client of a WebSocket
connection is called the connection <em>consumer</em>. An individual user will create
one consumer-connection pair per browser tab, window, or device they have open.</p>
<p>Connections are instances of <code>ApplicationCable::Connection</code>. In this class, you
authorize the incoming connection, and proceed to establish it if the user can
be identified.</p>
<h4><a class="anchor" aria-hidden="true" id="connection-setup"></a><a href="#connection-setup" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Connection Setup</h4>
<pre><code class="hljs css language-ruby"><span class="hljs-comment"># app/channels/application_cable/connection.rb</span>
<span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">ApplicationCable</span></span>
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Connection</span> &lt; ActionCable::Connection::<span class="hljs-title">Base</span></span>
    identified_by <span class="hljs-symbol">:current_user</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">connect</span></span>
      <span class="hljs-keyword">self</span>.current_user = find_verified_user
    <span class="hljs-keyword">end</span>

    private
      <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">find_verified_user</span></span>
        <span class="hljs-keyword">if</span> verified_user = User.find_by(<span class="hljs-symbol">id:</span> cookies.encrypted[<span class="hljs-symbol">:user_id</span>])
          verified_user
        <span class="hljs-keyword">else</span>
          reject_unauthorized_connection
        <span class="hljs-keyword">end</span>
      <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>Here <code>identified_by</code> is a connection identifier that can be used to find the
specific connection later. Note that anything marked as an identifier will automatically
create a delegate by the same name on any channel instances created off the connection.</p>
<p>This example relies on the fact that you will already have handled authentication of the user
somewhere else in your application, and that a successful authentication sets a signed
cookie with the user ID.</p>
<p>The cookie is then automatically sent to the connection instance when a new connection
is attempted, and you use that to set the <code>current_user</code>. By identifying the connection
by this same current user, you're also ensuring that you can later retrieve all open
connections by a given user (and potentially disconnect them all if the user is deleted
or unauthorized).</p>
<h3><a class="anchor" aria-hidden="true" id="channels"></a><a href="#channels" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Channels</h3>
<p>A <em>channel</em> encapsulates a logical unit of work, similar to what a controller does in a
regular MVC setup. By default, Rails creates a parent <code>ApplicationCable::Channel</code> class
for encapsulating shared logic between your channels.</p>
<h4><a class="anchor" aria-hidden="true" id="parent-channel-setup"></a><a href="#parent-channel-setup" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Parent Channel Setup</h4>
<pre><code class="hljs css language-ruby"><span class="hljs-comment"># app/channels/application_cable/channel.rb</span>
<span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">ApplicationCable</span></span>
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Channel</span> &lt; ActionCable::Channel::<span class="hljs-title">Base</span></span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>Then you would create your own channel classes. For example, you could have a
<code>ChatChannel</code> and an <code>AppearanceChannel</code>:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-comment"># app/channels/chat_channel.rb</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChatChannel</span> &lt; ApplicationCable::Channel</span>
<span class="hljs-keyword">end</span>

<span class="hljs-comment"># app/channels/appearance_channel.rb</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppearanceChannel</span> &lt; ApplicationCable::Channel</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>A consumer could then be subscribed to either or both of these channels.</p>
<h4><a class="anchor" aria-hidden="true" id="subscriptions"></a><a href="#subscriptions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Subscriptions</h4>
<p>Consumers subscribe to channels, acting as <em>subscribers</em>. Their connection is
called a <em>subscription</em>. Produced messages are then routed to these channel
subscriptions based on an identifier sent by the cable consumer.</p>
<pre><code class="hljs css language-ruby"><span class="hljs-comment"># app/channels/chat_channel.rb</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChatChannel</span> &lt; ApplicationCable::Channel</span>
  <span class="hljs-comment"># Called when the consumer has successfully</span>
  <span class="hljs-comment"># become a subscriber to this channel.</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">subscribed</span></span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="client-side-components"></a><a href="#client-side-components" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Client-Side Components</h2>
<h3><a class="anchor" aria-hidden="true" id="connections-1"></a><a href="#connections-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Connections</h3>
<p>Consumers require an instance of the connection on their side. This can be
established using the following JavaScript, which is generated by default by Rails:</p>
<h4><a class="anchor" aria-hidden="true" id="connect-consumer"></a><a href="#connect-consumer" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Connect Consumer</h4>
<pre><code class="hljs css language-js"><span class="hljs-comment">// app/javascript/channels/consumer.js</span>
<span class="hljs-comment">// Action Cable provides the framework to deal with WebSockets in Rails.</span>
<span class="hljs-comment">// You can generate new channels where WebSocket features live using the `rails generate channel` command.</span>

<span class="hljs-keyword">import</span> { createConsumer } <span class="hljs-keyword">from</span> <span class="hljs-string">"@rails/actioncable"</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> createConsumer()
</code></pre>
<p>This will ready a consumer that'll connect against <code>/cable</code> on your server by default.
The connection won't be established until you've also specified at least one subscription
you're interested in having.</p>
<p>The consumer can optionally take an argument that specifies the URL to connect to. This
can be a string, or a function that returns a string that will be called when the
WebSocket is opened.</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// Specify a different URL to connect to</span>
createConsumer(<span class="hljs-string">'https://ws.example.com/cable'</span>)

<span class="hljs-comment">// Use a function to dynamically generate the URL</span>
createConsumer(getWebSocketURL)

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getWebSocketURL</span> </span>{
  <span class="hljs-keyword">const</span> token = localStorage.get(<span class="hljs-string">'auth-token'</span>)
  <span class="hljs-keyword">return</span> <span class="hljs-string">`https://ws.example.com/cable?token=<span class="hljs-subst">${token}</span>`</span>
}
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="subscriber"></a><a href="#subscriber" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Subscriber</h4>
<p>A consumer becomes a subscriber by creating a subscription to a given channel:</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// app/javascript/channels/chat_channel.js</span>
<span class="hljs-keyword">import</span> consumer <span class="hljs-keyword">from</span> <span class="hljs-string">"./consumer"</span>

consumer.subscriptions.create({ <span class="hljs-attr">channel</span>: <span class="hljs-string">"ChatChannel"</span>, <span class="hljs-attr">room</span>: <span class="hljs-string">"Best Room"</span> })

<span class="hljs-comment">// app/javascript/channels/appearance_channel.js</span>
<span class="hljs-keyword">import</span> consumer <span class="hljs-keyword">from</span> <span class="hljs-string">"./consumer"</span>

consumer.subscriptions.create({ <span class="hljs-attr">channel</span>: <span class="hljs-string">"AppearanceChannel"</span> })
</code></pre>
<p>While this creates the subscription, the functionality needed to respond to
received data will be described later on.</p>
<p>A consumer can act as a subscriber to a given channel any number of times. For
example, a consumer could subscribe to multiple chat rooms at the same time:</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// app/javascript/channels/chat_channel.js</span>
<span class="hljs-keyword">import</span> consumer <span class="hljs-keyword">from</span> <span class="hljs-string">"./consumer"</span>

consumer.subscriptions.create({ <span class="hljs-attr">channel</span>: <span class="hljs-string">"ChatChannel"</span>, <span class="hljs-attr">room</span>: <span class="hljs-string">"1st Room"</span> })
consumer.subscriptions.create({ <span class="hljs-attr">channel</span>: <span class="hljs-string">"ChatChannel"</span>, <span class="hljs-attr">room</span>: <span class="hljs-string">"2nd Room"</span> })
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="client-server-interactions"></a><a href="#client-server-interactions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Client-Server Interactions</h2>
<h3><a class="anchor" aria-hidden="true" id="streams"></a><a href="#streams" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Streams</h3>
<p><em>Streams</em> provide the mechanism by which channels route published content
(broadcasts) to their subscribers.</p>
<pre><code class="hljs css language-ruby"><span class="hljs-comment"># app/channels/chat_channel.rb</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChatChannel</span> &lt; ApplicationCable::Channel</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">subscribed</span></span>
    stream_from <span class="hljs-string">"chat_<span class="hljs-subst">#{params[<span class="hljs-symbol">:room</span>]}</span>"</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>If you have a stream that is related to a model, then the broadcasting used
can be generated from the model and channel. The following example would
subscribe to a broadcasting like <code>comments:Z2lkOi8vVGVzdEFwcC9Qb3N0LzE</code></p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CommentsChannel</span> &lt; ApplicationCable::Channel</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">subscribed</span></span>
    post = Post.find(params[<span class="hljs-symbol">:id</span>])
    stream_for post
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>You can then broadcast to this channel like this:</p>
<pre><code class="hljs css language-ruby">CommentsChannel.broadcast_to(@post, @comment)
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="broadcasting"></a><a href="#broadcasting" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Broadcasting</h3>
<p>A <em>broadcasting</em> is a pub/sub link where anything transmitted by a publisher
is routed directly to the channel subscribers who are streaming that named
broadcasting. Each channel can be streaming zero or more broadcastings.</p>
<p>Broadcastings are purely an online queue and time-dependent. If a consumer is
not streaming (subscribed to a given channel), they'll not get the broadcast
should they connect later.</p>
<p>Broadcasts are called elsewhere in your Rails application:</p>
<pre><code class="hljs css language-ruby">WebNotificationsChannel.broadcast_to(
  current_user,
  <span class="hljs-symbol">title:</span> <span class="hljs-string">'New things!'</span>,
  <span class="hljs-symbol">body:</span> <span class="hljs-string">'All the news fit to print'</span>
)
</code></pre>
<p>The <code>WebNotificationsChannel.broadcast_to</code> call places a message in the current
subscription adapter's pubsub queue under a separate broadcasting name for each user.
The default pubsub queue for Action Cable is <code>redis</code> in production and <code>async</code> in development and
test environments. For a user with an ID of 1, the broadcasting name would be <code>web_notifications:1</code>.</p>
<p>The channel has been instructed to stream everything that arrives at
<code>web_notifications:1</code> directly to the client by invoking the <code>received</code>
callback.</p>
<h3><a class="anchor" aria-hidden="true" id="subscriptions-1"></a><a href="#subscriptions-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Subscriptions</h3>
<p>When a consumer is subscribed to a channel, they act as a subscriber. This
connection is called a subscription. Incoming messages are then routed to
these channel subscriptions based on an identifier sent by the cable consumer.</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// app/javascript/channels/chat_channel.js</span>
<span class="hljs-comment">// Assumes you've already requested the right to send web notifications</span>
<span class="hljs-keyword">import</span> consumer <span class="hljs-keyword">from</span> <span class="hljs-string">"./consumer"</span>

consumer.subscriptions.create({ <span class="hljs-attr">channel</span>: <span class="hljs-string">"ChatChannel"</span>, <span class="hljs-attr">room</span>: <span class="hljs-string">"Best Room"</span> }, {
  received(data) {
    <span class="hljs-keyword">this</span>.appendLine(data)
  },

  appendLine(data) {
    <span class="hljs-keyword">const</span> html = <span class="hljs-keyword">this</span>.createLine(data)
    <span class="hljs-keyword">const</span> element = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">"[data-chat-room='Best Room']"</span>)
    element.insertAdjacentHTML(<span class="hljs-string">"beforeend"</span>, html)
  },

  createLine(data) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`
      &lt;article class="chat-line"&gt;
        &lt;span class="speaker"&gt;<span class="hljs-subst">${data[<span class="hljs-string">"sent_by"</span>]}</span>&lt;/span&gt;
        &lt;span class="body"&gt;<span class="hljs-subst">${data[<span class="hljs-string">"body"</span>]}</span>&lt;/span&gt;
      &lt;/article&gt;
    `</span>
  }
})
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="passing-parameters-to-channels"></a><a href="#passing-parameters-to-channels" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Passing Parameters to Channels</h3>
<p>You can pass parameters from the client side to the server side when creating a
subscription. For example:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-comment"># app/channels/chat_channel.rb</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChatChannel</span> &lt; ApplicationCable::Channel</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">subscribed</span></span>
    stream_from <span class="hljs-string">"chat_<span class="hljs-subst">#{params[<span class="hljs-symbol">:room</span>]}</span>"</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>An object passed as the first argument to <code>subscriptions.create</code> becomes the
params hash in the cable channel. The keyword <code>channel</code> is required:</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// app/javascript/channels/chat_channel.js</span>
<span class="hljs-keyword">import</span> consumer <span class="hljs-keyword">from</span> <span class="hljs-string">"./consumer"</span>

consumer.subscriptions.create({ <span class="hljs-attr">channel</span>: <span class="hljs-string">"ChatChannel"</span>, <span class="hljs-attr">room</span>: <span class="hljs-string">"Best Room"</span> }, {
  received(data) {
    <span class="hljs-keyword">this</span>.appendLine(data)
  },

  appendLine(data) {
    <span class="hljs-keyword">const</span> html = <span class="hljs-keyword">this</span>.createLine(data)
    <span class="hljs-keyword">const</span> element = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">"[data-chat-room='Best Room']"</span>)
    element.insertAdjacentHTML(<span class="hljs-string">"beforeend"</span>, html)
  },

  createLine(data) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`
      &lt;article class="chat-line"&gt;
        &lt;span class="speaker"&gt;<span class="hljs-subst">${data[<span class="hljs-string">"sent_by"</span>]}</span>&lt;/span&gt;
        &lt;span class="body"&gt;<span class="hljs-subst">${data[<span class="hljs-string">"body"</span>]}</span>&lt;/span&gt;
      &lt;/article&gt;
    `</span>
  }
})
</code></pre>
<pre><code class="hljs css language-ruby"><span class="hljs-comment"># Somewhere in your app this is called, perhaps</span>
<span class="hljs-comment"># from a NewCommentJob.</span>
ActionCable.server.broadcast(
  <span class="hljs-string">"chat_<span class="hljs-subst">#{room}</span>"</span>,
  <span class="hljs-symbol">sent_by:</span> <span class="hljs-string">'Paul'</span>,
  <span class="hljs-symbol">body:</span> <span class="hljs-string">'This is a cool chat app.'</span>
)
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="rebroadcasting-a-message"></a><a href="#rebroadcasting-a-message" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Rebroadcasting a Message</h3>
<p>A common use case is to <em>rebroadcast</em> a message sent by one client to any
other connected clients.</p>
<pre><code class="hljs css language-ruby"><span class="hljs-comment"># app/channels/chat_channel.rb</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChatChannel</span> &lt; ApplicationCable::Channel</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">subscribed</span></span>
    stream_from <span class="hljs-string">"chat_<span class="hljs-subst">#{params[<span class="hljs-symbol">:room</span>]}</span>"</span>
  <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">receive</span><span class="hljs-params">(data)</span></span>
    ActionCable.server.broadcast(<span class="hljs-string">"chat_<span class="hljs-subst">#{params[<span class="hljs-symbol">:room</span>]}</span>"</span>, data)
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<pre><code class="hljs css language-js"><span class="hljs-comment">// app/javascript/channels/chat_channel.js</span>
<span class="hljs-keyword">import</span> consumer <span class="hljs-keyword">from</span> <span class="hljs-string">"./consumer"</span>

<span class="hljs-keyword">const</span> chatChannel = consumer.subscriptions.create({ <span class="hljs-attr">channel</span>: <span class="hljs-string">"ChatChannel"</span>, <span class="hljs-attr">room</span>: <span class="hljs-string">"Best Room"</span> }, {
  received(data) {
    <span class="hljs-comment">// data =&gt; { sent_by: "Paul", body: "This is a cool chat app." }</span>
  }
}

chatChannel.send({ <span class="hljs-attr">sent_by</span>: <span class="hljs-string">"Paul"</span>, <span class="hljs-attr">body</span>: <span class="hljs-string">"This is a cool chat app."</span> })
</code></pre>
<p>The rebroadcast will be received by all connected clients, <em>including</em> the
client that sent the message. Note that params are the same as they were when
you subscribed to the channel.</p>
<h2><a class="anchor" aria-hidden="true" id="full-stack-examples"></a><a href="#full-stack-examples" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Full-Stack Examples</h2>
<p>The following setup steps are common to both examples:</p>
<ol>
<li><a href="#connection-setup">Setup your connection</a>.</li>
<li><a href="#parent-channel-setup">Setup your parent channel</a>.</li>
<li><a href="#connect-consumer">Connect your consumer</a>.</li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="example-1-user-appearances"></a><a href="#example-1-user-appearances" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example 1: User Appearances</h3>
<p>Here's a simple example of a channel that tracks whether a user is online or not
and what page they're on. (This is useful for creating presence features like showing
a green dot next to a user name if they're online).</p>
<p>Create the server-side appearance channel:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-comment"># app/channels/appearance_channel.rb</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppearanceChannel</span> &lt; ApplicationCable::Channel</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">subscribed</span></span>
    current_user.appear
  <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">unsubscribed</span></span>
    current_user.disappear
  <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">appear</span><span class="hljs-params">(data)</span></span>
    current_user.appear(<span class="hljs-symbol">on:</span> data[<span class="hljs-string">'appearing_on'</span>])
  <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">away</span></span>
    current_user.away
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>When a subscription is initiated the <code>subscribed</code> callback gets fired and we
take that opportunity to say &quot;the current user has indeed appeared&quot;. That
appear/disappear API could be backed by Redis, a database, or whatever else.</p>
<p>Create the client-side appearance channel subscription:</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// app/javascript/channels/appearance_channel.js</span>
<span class="hljs-keyword">import</span> consumer <span class="hljs-keyword">from</span> <span class="hljs-string">"./consumer"</span>

consumer.subscriptions.create(<span class="hljs-string">"AppearanceChannel"</span>, {
  <span class="hljs-comment">// Called once when the subscription is created.</span>
  initialized() {
    <span class="hljs-keyword">this</span>.update = <span class="hljs-keyword">this</span>.update.bind(<span class="hljs-keyword">this</span>)
  },

  <span class="hljs-comment">// Called when the subscription is ready for use on the server.</span>
  connected() {
    <span class="hljs-keyword">this</span>.install()
    <span class="hljs-keyword">this</span>.update()
  },

  <span class="hljs-comment">// Called when the WebSocket connection is closed.</span>
  disconnected() {
    <span class="hljs-keyword">this</span>.uninstall()
  },

  <span class="hljs-comment">// Called when the subscription is rejected by the server.</span>
  rejected() {
    <span class="hljs-keyword">this</span>.uninstall()
  },

  update() {
    <span class="hljs-keyword">this</span>.documentIsActive ? <span class="hljs-keyword">this</span>.appear() : <span class="hljs-keyword">this</span>.away()
  },

  appear() {
    <span class="hljs-comment">// Calls `AppearanceChannel#appear(data)` on the server.</span>
    <span class="hljs-keyword">this</span>.perform(<span class="hljs-string">"appear"</span>, { <span class="hljs-attr">appearing_on</span>: <span class="hljs-keyword">this</span>.appearingOn })
  },

  away() {
    <span class="hljs-comment">// Calls `AppearanceChannel#away` on the server.</span>
    <span class="hljs-keyword">this</span>.perform(<span class="hljs-string">"away"</span>)
  },

  install() {
    <span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">"focus"</span>, <span class="hljs-keyword">this</span>.update)
    <span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">"blur"</span>, <span class="hljs-keyword">this</span>.update)
    <span class="hljs-built_in">document</span>.addEventListener(<span class="hljs-string">"turbolinks:load"</span>, <span class="hljs-keyword">this</span>.update)
    <span class="hljs-built_in">document</span>.addEventListener(<span class="hljs-string">"visibilitychange"</span>, <span class="hljs-keyword">this</span>.update)
  },

  uninstall() {
    <span class="hljs-built_in">window</span>.removeEventListener(<span class="hljs-string">"focus"</span>, <span class="hljs-keyword">this</span>.update)
    <span class="hljs-built_in">window</span>.removeEventListener(<span class="hljs-string">"blur"</span>, <span class="hljs-keyword">this</span>.update)
    <span class="hljs-built_in">document</span>.removeEventListener(<span class="hljs-string">"turbolinks:load"</span>, <span class="hljs-keyword">this</span>.update)
    <span class="hljs-built_in">document</span>.removeEventListener(<span class="hljs-string">"visibilitychange"</span>, <span class="hljs-keyword">this</span>.update)
  },

  <span class="hljs-keyword">get</span> documentIsActive() {
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">document</span>.visibilityState == <span class="hljs-string">"visible"</span> &amp;&amp; <span class="hljs-built_in">document</span>.hasFocus()
  },

  <span class="hljs-keyword">get</span> appearingOn() {
    <span class="hljs-keyword">const</span> element = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">"[data-appearing-on]"</span>)
    <span class="hljs-keyword">return</span> element ? element.getAttribute(<span class="hljs-string">"data-appearing-on"</span>) : <span class="hljs-literal">null</span>
  }
})
</code></pre>
<h5><a class="anchor" aria-hidden="true" id="client-server-interaction"></a><a href="#client-server-interaction" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Client-Server Interaction</h5>
<ol>
<li><p><strong>Client</strong> connects to the <strong>Server</strong> via <code>App.cable = ActionCable.createConsumer(&quot;ws://cable.example.com&quot;)</code>. (<code>cable.js</code>). The
<strong>Server</strong> identifies this connection by <code>current_user</code>.</p></li>
<li><p><strong>Client</strong> subscribes to the appearance channel via
<code>consumer.subscriptions.create({ channel: &quot;AppearanceChannel&quot; })</code>. (<code>appearance_channel.js</code>)</p></li>
<li><p><strong>Server</strong> recognizes a new subscription has been initiated for the
appearance channel and runs its <code>subscribed</code> callback, calling the <code>appear</code>
method on <code>current_user</code>. (<code>appearance_channel.rb</code>)</p></li>
<li><p><strong>Client</strong> recognizes that a subscription has been established and calls
<code>connected</code> (<code>appearance_channel.js</code>) which in turn calls <code>install</code> and <code>appear</code>.
<code>appear</code> calls <code>AppearanceChannel#appear(data)</code> on the server, and supplies a
data hash of <code>{ appearing_on: this.appearingOn }</code>. This is
possible because the server-side channel instance automatically exposes all
public methods declared on the class (minus the callbacks), so that these can be
reached as remote procedure calls via a subscription's <code>perform</code> method.</p></li>
<li><p><strong>Server</strong> receives the request for the <code>appear</code> action on the appearance
channel for the connection identified by <code>current_user</code>
(<code>appearance_channel.rb</code>). <strong>Server</strong> retrieves the data with the
<code>:appearing_on</code> key from the data hash and sets it as the value for the <code>:on</code>
key being passed to <code>current_user.appear</code>.</p></li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="example-2-receiving-new-web-notifications"></a><a href="#example-2-receiving-new-web-notifications" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example 2: Receiving New Web Notifications</h3>
<p>The appearance example was all about exposing server functionality to
client-side invocation over the WebSocket connection. But the great thing
about WebSockets is that it's a two-way street. So now let's show an example
where the server invokes an action on the client.</p>
<p>This is a web notification channel that allows you to trigger client-side
web notifications when you broadcast to the right streams:</p>
<p>Create the server-side web notifications channel:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-comment"># app/channels/web_notifications_channel.rb</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebNotificationsChannel</span> &lt; ApplicationCable::Channel</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">subscribed</span></span>
    stream_for current_user
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>Create the client-side web notifications channel subscription:</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// app/javascript/channels/web_notifications_channel.js</span>
<span class="hljs-comment">// Client-side which assumes you've already requested</span>
<span class="hljs-comment">// the right to send web notifications.</span>
<span class="hljs-keyword">import</span> consumer <span class="hljs-keyword">from</span> <span class="hljs-string">"./consumer"</span>

consumer.subscriptions.create(<span class="hljs-string">"WebNotificationsChannel"</span>, {
  received(data) {
    <span class="hljs-keyword">new</span> Notification(data[<span class="hljs-string">"title"</span>], <span class="hljs-attr">body</span>: data[<span class="hljs-string">"body"</span>])
  }
})
</code></pre>
<p>Broadcast content to a web notification channel instance from elsewhere in your
application:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-comment"># Somewhere in your app this is called, perhaps from a NewCommentJob</span>
WebNotificationsChannel.broadcast_to(
  current_user,
  <span class="hljs-symbol">title:</span> <span class="hljs-string">'New things!'</span>,
  <span class="hljs-symbol">body:</span> <span class="hljs-string">'All the news fit to print'</span>
)
</code></pre>
<p>The <code>WebNotificationsChannel.broadcast_to</code> call places a message in the current
subscription adapter's pubsub queue under a separate broadcasting name for each
user. For a user with an ID of 1, the broadcasting name would be
<code>web_notifications:1</code>.</p>
<p>The channel has been instructed to stream everything that arrives at
<code>web_notifications:1</code> directly to the client by invoking the <code>received</code>
callback. The data passed as argument is the hash sent as the second parameter
to the server-side broadcast call, JSON encoded for the trip across the wire
and unpacked for the data argument arriving as <code>received</code>.</p>
<h3><a class="anchor" aria-hidden="true" id="more-complete-examples"></a><a href="#more-complete-examples" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>More Complete Examples</h3>
<p>See the <a href="https://github.com/rails/actioncable-examples">rails/actioncable-examples</a>
repository for a full example of how to setup Action Cable in a Rails app and adding channels.</p>
<h2><a class="anchor" aria-hidden="true" id="configuration"></a><a href="#configuration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration</h2>
<p>Action Cable has two required configurations: a subscription adapter and allowed request origins.</p>
<h3><a class="anchor" aria-hidden="true" id="subscription-adapter"></a><a href="#subscription-adapter" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Subscription Adapter</h3>
<p>By default, Action Cable looks for a configuration file in <code>config/cable.yml</code>.
The file must specify an adapter for each Rails environment. See the
<a href="#dependencies">Dependencies</a> section for additional information on adapters.</p>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">development:</span>
<span class="hljs-attr">  adapter:</span> <span class="hljs-string">async</span>

<span class="hljs-attr">test:</span>
<span class="hljs-attr">  adapter:</span> <span class="hljs-string">async</span>

<span class="hljs-attr">production:</span>
<span class="hljs-attr">  adapter:</span> <span class="hljs-string">redis</span>
<span class="hljs-attr">  url:</span> <span class="hljs-attr">redis://10.10.3.153:6381</span>
<span class="hljs-attr">  channel_prefix:</span> <span class="hljs-string">appname_production</span>
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="adapter-configuration"></a><a href="#adapter-configuration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Adapter Configuration</h4>
<p>Below is a list of the subscription adapters available for end users.</p>
<h5><a class="anchor" aria-hidden="true" id="async-adapter"></a><a href="#async-adapter" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Async Adapter</h5>
<p>The async adapter is intended for development/testing and should not be used in production.</p>
<h5><a class="anchor" aria-hidden="true" id="redis-adapter"></a><a href="#redis-adapter" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Redis Adapter</h5>
<p>The Redis adapter requires users to provide a URL pointing to the Redis server.
Additionally, a <code>channel_prefix</code> may be provided to avoid channel name collisions
when using the same Redis server for multiple applications. See the <a href="https://redis.io/topics/pubsub#database-amp-scoping">Redis PubSub documentation</a> for more details.</p>
<h5><a class="anchor" aria-hidden="true" id="postgresql-adapter"></a><a href="#postgresql-adapter" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>PostgreSQL Adapter</h5>
<p>The PostgreSQL adapter uses Active Record's connection pool, and thus the
application's <code>config/database.yml</code> database configuration, for its connection.
This may change in the future. <a href="https://github.com/rails/rails/issues/27214">#27214</a></p>
<h3><a class="anchor" aria-hidden="true" id="allowed-request-origins"></a><a href="#allowed-request-origins" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Allowed Request Origins</h3>
<p>Action Cable will only accept requests from specified origins, which are
passed to the server config as an array. The origins can be instances of
strings or regular expressions, against which a check for the match will be performed.</p>
<pre><code class="hljs css language-ruby">config.action_cable.allowed_request_origins = [<span class="hljs-string">'https://rubyonrails.com'</span>, <span class="hljs-regexp">%r{http://ruby.*}</span>]
</code></pre>
<p>To disable and allow requests from any origin:</p>
<pre><code class="hljs css language-ruby">config.action_cable.disable_request_forgery_protection = <span class="hljs-literal">true</span>
</code></pre>
<p>By default, Action Cable allows all requests from localhost:3000 when running
in the development environment.</p>
<h3><a class="anchor" aria-hidden="true" id="consumer-configuration"></a><a href="#consumer-configuration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Consumer Configuration</h3>
<p>To configure the URL, add a call to <code>action_cable_meta_tag</code> in your HTML layout
HEAD. This uses a URL or path typically set via <code>config.action_cable.url</code> in the
environment configuration files.</p>
<h3><a class="anchor" aria-hidden="true" id="worker-pool-configuration"></a><a href="#worker-pool-configuration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Worker Pool Configuration</h3>
<p>The worker pool is used to run connection callbacks and channel actions in
isolation from the server's main thread. Action Cable allows the application
to configure the number of simultaneously processed threads in the worker pool.</p>
<pre><code class="hljs css language-ruby">config.action_cable.worker_pool_size = <span class="hljs-number">4</span>
</code></pre>
<p>Also, note that your server must provide at least the same number of database
connections as you have workers. The default worker pool size is set to 4, so
that means you have to make at least 4 database connections available.
You can change that in <code>config/database.yml</code> through the <code>pool</code> attribute.</p>
<h3><a class="anchor" aria-hidden="true" id="other-configurations"></a><a href="#other-configurations" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Other Configurations</h3>
<p>The other common option to configure is the log tags applied to the
per-connection logger. Here's an example that uses
the user account id if available, else &quot;no-account&quot; while tagging:</p>
<pre><code class="hljs css language-ruby">config.action_cable.log_tags = [
  -&gt; request { request.env[<span class="hljs-string">'user_account_id'</span>] <span class="hljs-params">||</span> <span class="hljs-string">"no-account"</span> },
  <span class="hljs-symbol">:action_cable</span>,
  -&gt; request { request.uuid }
]
</code></pre>
<p>For a full list of all configuration options, see the
<code>ActionCable::Server::Configuration</code> class.</p>
<h2><a class="anchor" aria-hidden="true" id="running-standalone-cable-servers"></a><a href="#running-standalone-cable-servers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Running Standalone Cable Servers</h2>
<h3><a class="anchor" aria-hidden="true" id="in-app"></a><a href="#in-app" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>In App</h3>
<p>Action Cable can run alongside your Rails application. For example, to
listen for WebSocket requests on <code>/websocket</code>, specify that path to
<code>config.action_cable.mount_path</code>:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-comment"># config/application.rb</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> &lt; Rails::Application</span>
  config.action_cable.mount_path = <span class="hljs-string">'/websocket'</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>You can use <code>ActionCable.createConsumer()</code> to connect to the cable
server if <code>action_cable_meta_tag</code> is invoked in the layout. Otherwise, A path is
specified as first argument to <code>createConsumer</code> (e.g. <code>ActionCable.createConsumer(&quot;/websocket&quot;)</code>).</p>
<p>For every instance of your server you create and for every worker your server
spawns, you will also have a new instance of Action Cable, but the use of Redis
keeps messages synced across connections.</p>
<h3><a class="anchor" aria-hidden="true" id="standalone"></a><a href="#standalone" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Standalone</h3>
<p>The cable servers can be separated from your normal application server. It's
still a Rack application, but it is its own Rack application. The recommended
basic setup is as follows:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-comment"># cable/config.ru</span>
require_relative <span class="hljs-string">'../config/environment'</span>
Rails.application.eager_load!

run ActionCable.server
</code></pre>
<p>Then you start the server using a binstub in <code>bin/cable</code> ala:</p>
<pre><code class="hljs"><span class="hljs-meta">#!/bin/bash</span>
bundle <span class="hljs-built_in">exec</span> puma -p 28080 cable/config.ru
</code></pre>
<p>The above will start a cable server on port 28080.</p>
<h3><a class="anchor" aria-hidden="true" id="notes"></a><a href="#notes" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Notes</h3>
<p>The WebSocket server doesn't have access to the session, but it has
access to the cookies. This can be used when you need to handle
authentication. You can see one way of doing that with Devise in this <a href="https://greg.molnar.io/blog/actioncable-devise-authentication/">article</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="dependencies"></a><a href="#dependencies" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dependencies</h2>
<p>Action Cable provides a subscription adapter interface to process its
pubsub internals. By default, asynchronous, inline, PostgreSQL, and Redis
adapters are included. The default adapter
in new Rails applications is the asynchronous (<code>async</code>) adapter.</p>
<p>The Ruby side of things is built on top of <a href="https://github.com/faye/websocket-driver-ruby">websocket-driver</a>,
<a href="https://github.com/celluloid/nio4r">nio4r</a>, and <a href="https://github.com/ruby-concurrency/concurrent-ruby">concurrent-ruby</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="deployment"></a><a href="#deployment" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Deployment</h2>
<p>Action Cable is powered by a combination of WebSockets and threads. Both the
framework plumbing and user-specified channel work are handled internally by
utilizing Ruby's native thread support. This means you can use all your regular
Rails models with no problem, as long as you haven't committed any thread-safety sins.</p>
<p>The Action Cable server implements the Rack socket hijacking API,
thereby allowing the use of a multithreaded pattern for managing connections
internally, irrespective of whether the application server is multi-threaded or not.</p>
<p>Accordingly, Action Cable works with popular servers like Unicorn, Puma, and
Passenger.</p>
<h2><a class="anchor" aria-hidden="true" id="testing"></a><a href="#testing" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Testing</h2>
<p>You can find detailed instructions on how to test your Action Cable functionality in the
<a href="/rails-setup/docs/rails/testing-rails#testing-action-cable">testing guide</a>.</p>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 2019-7-7</em></div><div class="docs-prevnext"><a class="docs-prev button" href="/rails-setup/docs/rails/active-storage"><span class="arrow-prev">← </span><span>Active Storage Overview</span></a><a class="docs-next button" href="/rails-setup/docs/rails/rails-i18n"><span>Rails Internationalization (I18n) API</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#introduction">Introduction</a></li><li><a href="#terminology">Terminology</a></li><li><a href="#what-is-pub-sub">What is Pub/Sub</a></li><li><a href="#server-side-components">Server-Side Components</a><ul class="toc-headings"><li><a href="#connections">Connections</a></li><li><a href="#channels">Channels</a></li></ul></li><li><a href="#client-side-components">Client-Side Components</a><ul class="toc-headings"><li><a href="#connections-1">Connections</a></li></ul></li><li><a href="#client-server-interactions">Client-Server Interactions</a><ul class="toc-headings"><li><a href="#streams">Streams</a></li><li><a href="#broadcasting">Broadcasting</a></li><li><a href="#subscriptions-1">Subscriptions</a></li><li><a href="#passing-parameters-to-channels">Passing Parameters to Channels</a></li><li><a href="#rebroadcasting-a-message">Rebroadcasting a Message</a></li></ul></li><li><a href="#full-stack-examples">Full-Stack Examples</a><ul class="toc-headings"><li><a href="#example-1-user-appearances">Example 1: User Appearances</a></li><li><a href="#example-2-receiving-new-web-notifications">Example 2: Receiving New Web Notifications</a></li><li><a href="#more-complete-examples">More Complete Examples</a></li></ul></li><li><a href="#configuration">Configuration</a><ul class="toc-headings"><li><a href="#subscription-adapter">Subscription Adapter</a></li><li><a href="#allowed-request-origins">Allowed Request Origins</a></li><li><a href="#consumer-configuration">Consumer Configuration</a></li><li><a href="#worker-pool-configuration">Worker Pool Configuration</a></li><li><a href="#other-configurations">Other Configurations</a></li></ul></li><li><a href="#running-standalone-cable-servers">Running Standalone Cable Servers</a><ul class="toc-headings"><li><a href="#in-app">In App</a></li><li><a href="#standalone">Standalone</a></li><li><a href="#notes">Notes</a></li></ul></li><li><a href="#dependencies">Dependencies</a></li><li><a href="#deployment">Deployment</a></li><li><a href="#testing">Testing</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="copyright">Rails Setup 2019</section></footer></div></body></html>