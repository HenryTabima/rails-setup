<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>The Asset Pipeline · Rails Setup</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;This guide covers the asset pipeline.&lt;/p&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="The Asset Pipeline · Rails Setup"/><meta property="og:type" content="website"/><meta property="og:url" content="https://HenryTabima.github.io/rails-setup/"/><meta property="og:description" content="&lt;p&gt;This guide covers the asset pipeline.&lt;/p&gt;
"/><meta property="og:image" content="https://HenryTabima.github.io/rails-setup/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://HenryTabima.github.io/rails-setup/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/rails-setup/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/rails-setup/js/scrollSpy.js"></script><link rel="stylesheet" href="/rails-setup/css/main.css"/><script src="/rails-setup/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/rails-setup/"><img class="logo" src="/rails-setup/img/favicon.ico" alt="Rails Setup"/><h2 class="headerTitleWithLogo">Rails Setup</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/rails-setup/docs/rails/getting-started" target="_self">Rails</a></li><li class=""><a href="/rails-setup/docs/devise/overview" target="_self">Devise</a></li><li class=""><a href="https://github.com/HenryTabima/rails-setup" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Digging Deeper</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Start Here<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/getting-started">Getting Started with Rails</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/development-dependencies-install">Development Dependencies Install</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Models<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/active-record-basics">Active Record Basics</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/active-record-migrations">Active Record Migrations</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/active-record-validations">Active Record Validations</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/active-record-callbacks">Active Record Callbacks</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/active-record-associations">Active Record Associations</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/active-record-query">Active Record Query Interface</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/multiple-databases">Multiple Databases with Active Record</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/active-record-postgresql">Active Record and PostgreSQL</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Views<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/layouts-and-rendering">Layouts and Rendering in Rails</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/action-view">Action View Overview</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/action-view-form-helpers">Action View Form Helpers</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Controllers<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/action-controller">Action Controller Overview</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/rails-routing">Rails Routing from the Outside In</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Other Components<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/active-support-core">Active Support Core Extensions</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/active-support-instrumentation">Active Support Instrumentation</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/action-mailer">Action Mailer Basics</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/action-mailbox">Action Mailbox Basics</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/active-model">Active Model Basics</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/active-job">Active Job Basics</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/action-text">Action Text Overview</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/active-storage">Active Storage Overview</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/action-cable">Action Cable Overview</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Digging Deeper<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/rails-i18n">Rails Internationalization (I18n) API</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/testing-rails">Testing Rails Applications</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/securing-rails">Securing Rails Applications</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/debugging-rails">Debugging Rails Applications</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/configuring-rails">Configuring Rails Applications</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/rails-command-line">The Rails Command Line</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/rails-setup/docs/rails/asset-pipeline">The Asset Pipeline</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/working-with-javascript">Working with JavaScript in Rails</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/autoloading-and-reloading">Autoloading and Reloading Constants</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/caching-with-rails">Caching with Rails: An Overview</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/api-only-apps">Using Rails for API-only Applications</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/threading">Threading and Code Execution in Rails</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/initialization">The Rails Initialization Process</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/engines">Getting Started with Engines</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Extending Rails<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/rails-on-rack">Rails on Rack</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/generators-&amp;-templates">Creating and Customizing Rails Generators &amp; Templates</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/application-templates">Rails Application Templates</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/creating-rails-plugins">The Basics of Creating Rails Plugins</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Contributions<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/contributing-to-rails">Contributing to Ruby on Rails</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/api-documentation">API Documentation Guidelines</a></li><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/guides-guidelines">Ruby on Rails Guides Guidelines</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Policies<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/rails-setup/docs/rails/maintenance-policy">Maintenance Policy for Ruby on Rails</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">The Asset Pipeline</h1></header><article><div><span><p>This guide covers the asset pipeline.</p>
<p>After reading this guide, you will know:</p>
<ul>
<li>What the asset pipeline is and what it does.</li>
<li>How to properly organize your application assets.</li>
<li>The benefits of the asset pipeline.</li>
<li>How to add a pre-processor to the pipeline.</li>
<li>How to package assets with a gem.</li>
</ul>
<hr>
<h2><a class="anchor" aria-hidden="true" id="what-is-the-asset-pipeline"></a><a href="#what-is-the-asset-pipeline" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What is the Asset Pipeline?</h2>
<p>The asset pipeline provides a framework to concatenate and minify or compress
JavaScript and CSS assets. It also adds the ability to write these assets in
other languages and pre-processors such as CoffeeScript, Sass, and ERB.
It allows assets in your application to be automatically combined with assets
from other gems.</p>
<p>The asset pipeline is implemented by the
<a href="https://github.com/rails/sprockets-rails">sprockets-rails</a> gem,
and is enabled by default. You can disable it while creating a new application by
passing the <code>--skip-sprockets</code> option.</p>
<pre><code class="hljs css language-bash">rails new appname --skip-sprockets
</code></pre>
<p>Rails automatically adds the <code>sass-rails</code> gem to your <code>Gemfile</code>, which is used
by Sprockets for asset compression:</p>
<pre><code class="hljs css language-ruby">gem <span class="hljs-string">'sass-rails'</span>
</code></pre>
<p>Using the <code>--skip-sprockets</code> option will prevent Rails from adding
them to your <code>Gemfile</code>, so if you later want to enable
the asset pipeline you will have to add those gems to your <code>Gemfile</code>. Also,
creating an application with the <code>--skip-sprockets</code> option will generate
a slightly different <code>config/application.rb</code> file, with a require statement
for the sprockets railtie that is commented-out. You will have to remove
the comment operator on that line to later enable the asset pipeline:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-comment"># require "sprockets/railtie"</span>
</code></pre>
<p>To set asset compression methods, set the appropriate configuration options
in <code>production.rb</code> - <code>config.assets.css_compressor</code> for your CSS and
<code>config.assets.js_compressor</code> for your JavaScript:</p>
<pre><code class="hljs css language-ruby">config.assets.css_compressor = <span class="hljs-symbol">:yui</span>
config.assets.js_compressor = <span class="hljs-symbol">:uglifier</span>
</code></pre>
<p>NOTE: The <code>sass-rails</code> gem is automatically used for CSS compression if included
in the <code>Gemfile</code> and no <code>config.assets.css_compressor</code> option is set.</p>
<h3><a class="anchor" aria-hidden="true" id="main-features"></a><a href="#main-features" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Main Features</h3>
<p>The first feature of the pipeline is to concatenate assets, which can reduce the
number of requests that a browser makes to render a web page. Web browsers are
limited in the number of requests that they can make in parallel, so fewer
requests can mean faster loading for your application.</p>
<p>Sprockets concatenates all JavaScript files into one master <code>.js</code> file and all
CSS files into one master <code>.css</code> file. As you'll learn later in this guide, you
can customize this strategy to group files any way you like. In production,
Rails inserts an SHA256 fingerprint into each filename so that the file is
cached by the web browser. You can invalidate the cache by altering this
fingerprint, which happens automatically whenever you change the file contents.</p>
<p>The second feature of the asset pipeline is asset minification or compression.
For CSS files, this is done by removing whitespace and comments. For JavaScript,
more complex processes can be applied. You can choose from a set of built in
options or specify your own.</p>
<p>The third feature of the asset pipeline is it allows coding assets via a
higher-level language, with precompilation down to the actual assets. Supported
languages include Sass for CSS, CoffeeScript for JavaScript, and ERB for both by
default.</p>
<h3><a class="anchor" aria-hidden="true" id="what-is-fingerprinting-and-why-should-i-care"></a><a href="#what-is-fingerprinting-and-why-should-i-care" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What is Fingerprinting and Why Should I Care?</h3>
<p>Fingerprinting is a technique that makes the name of a file dependent on the
contents of the file. When the file contents change, the filename is also
changed. For content that is static or infrequently changed, this provides an
easy way to tell whether two versions of a file are identical, even across
different servers or deployment dates.</p>
<p>When a filename is unique and based on its content, HTTP headers can be set to
encourage caches everywhere (whether at CDNs, at ISPs, in networking equipment,
or in web browsers) to keep their own copy of the content. When the content is
updated, the fingerprint will change. This will cause the remote clients to
request a new copy of the content. This is generally known as <em>cache busting</em>.</p>
<p>The technique Sprockets uses for fingerprinting is to insert a hash of the
content into the name, usually at the end. For example a CSS file <code>global.css</code></p>
<pre><code class="hljs">global-<span class="hljs-number">908</span>e25f4bf641868d8683022a5b62f54<span class="hljs-selector-class">.css</span>
</code></pre>
<p>This is the strategy adopted by the Rails asset pipeline.</p>
<p>Rails' old strategy was to append a date-based query string to every asset linked
with a built-in helper. In the source the generated code looked like this:</p>
<pre><code class="hljs">/stylesheets/global.css?<span class="hljs-number">1309495796</span>
</code></pre>
<p>The query string strategy has several disadvantages:</p>
<ol>
<li><p><strong>Not all caches will reliably cache content where the filename only differs by
query parameters</strong></p>
<p><a href="https://www.stevesouders.com/blog/2008/08/23/revving-filenames-dont-use-querystring/">Steve Souders recommends</a>,
&quot;...avoiding a querystring for cacheable resources&quot;. He found that in this
case 5-20% of requests will not be cached. Query strings in particular do not
work at all with some CDNs for cache invalidation.</p></li>
<li><p><strong>The file name can change between nodes in multi-server environments.</strong></p>
<p>The default query string in Rails 2.x is based on the modification time of
the files. When assets are deployed to a cluster, there is no guarantee that the
timestamps will be the same, resulting in different values being used depending
on which server handles the request.</p></li>
<li><p><strong>Too much cache invalidation</strong></p>
<p>When static assets are deployed with each new release of code, the mtime
(time of last modification) of <em>all</em> these files changes, forcing all remote
clients to fetch them again, even when the content of those assets has not changed.</p></li>
</ol>
<p>Fingerprinting fixes these problems by avoiding query strings, and by ensuring
that filenames are consistent based on their content.</p>
<p>Fingerprinting is enabled by default for both the development and production
environments. You can enable or disable it in your configuration through the
<code>config.assets.digest</code> option.</p>
<p>More reading:</p>
<ul>
<li><a href="https://developers.google.com/speed/docs/insights/LeverageBrowserCaching">Optimize caching</a></li>
<li><a href="http://www.stevesouders.com/blog/2008/08/23/revving-filenames-dont-use-querystring/">Revving Filenames: don't use querystring</a></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="how-to-use-the-asset-pipeline"></a><a href="#how-to-use-the-asset-pipeline" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How to Use the Asset Pipeline</h2>
<p>In previous versions of Rails, all assets were located in subdirectories of
<code>public</code> such as <code>images</code>, <code>javascripts</code> and <code>stylesheets</code>. With the asset
pipeline, the preferred location for these assets is now the <code>app/assets</code>
directory. Files in this directory are served by the Sprockets middleware.</p>
<p>Assets can still be placed in the <code>public</code> hierarchy. Any assets under <code>public</code>
will be served as static files by the application or web server when
<code>config.public_file_server.enabled</code> is set to true. You should use <code>app/assets</code> for
files that must undergo some pre-processing before they are served.</p>
<p>In production, Rails precompiles these files to <code>public/assets</code> by default. The
precompiled copies are then served as static assets by the web server. The files
in <code>app/assets</code> are never served directly in production.</p>
<h3><a class="anchor" aria-hidden="true" id="controller-specific-assets"></a><a href="#controller-specific-assets" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Controller Specific Assets</h3>
<p>When you generate a scaffold or a controller, Rails also generates a
Cascading Style Sheet file (or SCSS file if <code>sass-rails</code> is in the <code>Gemfile</code>)
for that controller. Additionally, when generating a scaffold, Rails generates
the file <code>scaffolds.css</code> (or <code>scaffolds.scss</code> if <code>sass-rails</code> is in the
<code>Gemfile</code>.)</p>
<p>For example, if you generate a <code>ProjectsController</code>, Rails will also add a new
file at <code>app/assets/stylesheets/projects.scss</code>. By default these files will be
ready to use by your application immediately using the <code>require_tree</code> directive. See
<a href="#manifest-files-and-directives">Manifest Files and Directives</a> for more details
on require_tree.</p>
<p>You can also opt to include controller specific stylesheets and JavaScript files
only in their respective controllers using the following:</p>
<p><code>&lt;%= javascript_include_tag params[:controller] %&gt;</code> or <code>&lt;%= stylesheet_link_tag params[:controller] %&gt;</code></p>
<p>When doing this, ensure you are not using the <code>require_tree</code> directive, as that
will result in your assets being included more than once.</p>
<p>WARNING: When using asset precompilation, you will need to ensure that your
controller assets will be precompiled when loading them on a per page basis. By
default <code>.coffee</code> and <code>.scss</code> files will not be precompiled on their own. See
<a href="#precompiling-assets">Precompiling Assets</a> for more information on how
precompiling works.</p>
<p>NOTE: You must have an ExecJS supported runtime in order to use CoffeeScript.
If you are using macOS or Windows, you have a JavaScript runtime installed in
your operating system. Check <a href="https://github.com/rails/execjs#readme">ExecJS</a> documentation to know all supported JavaScript runtimes.</p>
<p>You can also disable generation of controller specific asset files by adding the
following to your <code>config/application.rb</code> configuration:</p>
<pre><code class="hljs css language-ruby">  config.generators <span class="hljs-keyword">do</span> <span class="hljs-params">|g|</span>
    g.assets <span class="hljs-literal">false</span>
  <span class="hljs-keyword">end</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="asset-organization"></a><a href="#asset-organization" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Asset Organization</h3>
<p>Pipeline assets can be placed inside an application in one of three locations:
<code>app/assets</code>, <code>lib/assets</code> or <code>vendor/assets</code>.</p>
<ul>
<li><p><code>app/assets</code> is for assets that are owned by the application, such as custom
images, JavaScript files, or stylesheets.</p></li>
<li><p><code>lib/assets</code> is for your own libraries' code that doesn't really fit into the
scope of the application or those libraries which are shared across applications.</p></li>
<li><p><code>vendor/assets</code> is for assets that are owned by outside entities, such as
code for JavaScript plugins and CSS frameworks. Keep in mind that third party
code with references to other files also processed by the asset Pipeline (images,
stylesheets, etc.), will need to be rewritten to use helpers like <code>asset_path</code>.</p></li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="search-paths"></a><a href="#search-paths" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Search Paths</h4>
<p>When a file is referenced from a manifest or a helper, Sprockets searches the
three default asset locations for it.</p>
<p>The default locations are: the <code>images</code>, <code>javascripts</code> and <code>stylesheets</code>
directories under the <code>app/assets</code> folder, but these subdirectories
are not special - any path under <code>assets/*</code> will be searched.</p>
<p>For example, these files:</p>
<pre><code class="hljs">app/assets/javascripts/home.js
<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">assets</span>/<span class="hljs-title">javascripts</span>/<span class="hljs-title">moovinator</span>.<span class="hljs-title">js</span></span>
vendor/assets/javascripts/slider.js
vendor/assets/somepackage/phonebox.js
</code></pre>
<p>would be referenced in a manifest like this:</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">//= require home</span>
<span class="hljs-comment">//= require moovinator</span>
<span class="hljs-comment">//= require slider</span>
<span class="hljs-comment">//= require phonebox</span>
</code></pre>
<p>Assets inside subdirectories can also be accessed.</p>
<pre><code class="hljs">app<span class="hljs-regexp">/assets/</span>javascripts<span class="hljs-regexp">/sub/</span>something.js
</code></pre>
<p>is referenced as:</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">//= require sub/something</span>
</code></pre>
<p>You can view the search path by inspecting
<code>Rails.application.config.assets.paths</code> in the Rails console.</p>
<p>Besides the standard <code>assets/*</code> paths, additional (fully qualified) paths can be
added to the pipeline in <code>config/initializers/assets.rb</code>. For example:</p>
<pre><code class="hljs css language-ruby">Rails.application.config.assets.paths &lt;&lt; Rails.root.join(<span class="hljs-string">"lib"</span>, <span class="hljs-string">"videoplayer"</span>, <span class="hljs-string">"flash"</span>)
</code></pre>
<p>Paths are traversed in the order they occur in the search path. By default,
this means the files in <code>app/assets</code> take precedence, and will mask
corresponding paths in <code>lib</code> and <code>vendor</code>.</p>
<p>It is important to note that files you want to reference outside a manifest must
be added to the precompile array or they will not be available in the production
environment.</p>
<h4><a class="anchor" aria-hidden="true" id="using-index-files"></a><a href="#using-index-files" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using Index Files</h4>
<p>Sprockets uses files named <code>index</code> (with the relevant extensions) for a special
purpose.</p>
<p>For example, if you have a jQuery library with many modules, which is stored in
<code>lib/assets/javascripts/library_name</code>, the file <code>lib/assets/javascripts/library_name/index.js</code> serves as
the manifest for all files in this library. This file could include a list of
all the required files in order, or a simple <code>require_tree</code> directive.</p>
<p>The library as a whole can be accessed in the application manifest like so:</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">//= require library_name</span>
</code></pre>
<p>This simplifies maintenance and keeps things clean by allowing related code to
be grouped before inclusion elsewhere.</p>
<h3><a class="anchor" aria-hidden="true" id="coding-links-to-assets"></a><a href="#coding-links-to-assets" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Coding Links to Assets</h3>
<p>Sprockets does not add any new methods to access your assets - you still use the
familiar <code>javascript_include_tag</code> and <code>stylesheet_link_tag</code>:</p>
<pre><code class="hljs css language-erb"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> stylesheet_link_tag <span class="hljs-string">"application"</span>, <span class="hljs-symbol">media:</span> <span class="hljs-string">"all"</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> javascript_include_tag <span class="hljs-string">"application"</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
</span></code></pre>
<p>If using the turbolinks gem, which is included by default in Rails, then
include the 'data-turbolinks-track' option which causes turbolinks to check if
an asset has been updated and if so loads it into the page:</p>
<pre><code class="hljs css language-erb"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> stylesheet_link_tag <span class="hljs-string">"application"</span>, <span class="hljs-symbol">media:</span> <span class="hljs-string">"all"</span>, <span class="hljs-string">"data-turbolinks-track"</span> =&gt; <span class="hljs-string">"reload"</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> javascript_include_tag <span class="hljs-string">"application"</span>, <span class="hljs-string">"data-turbolinks-track"</span> =&gt; <span class="hljs-string">"reload"</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
</span></code></pre>
<p>In regular views you can access images in the <code>app/assets/images</code> directory
like this:</p>
<pre><code class="hljs css language-erb"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> image_tag <span class="hljs-string">"rails.png"</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
</span></code></pre>
<p>Provided that the pipeline is enabled within your application (and not disabled
in the current environment context), this file is served by Sprockets. If a file
exists at <code>public/assets/rails.png</code> it is served by the web server.</p>
<p>Alternatively, a request for a file with an SHA256 hash such as
<code>public/assets/rails-f90d8a84c707a8dc923fca1ca1895ae8ed0a09237f6992015fef1e11be77c023.png</code>
is treated the same way. How these hashes are generated is covered in the <a href="#in-production">In
Production</a> section later on in this guide.</p>
<p>Sprockets will also look through the paths specified in <code>config.assets.paths</code>,
which includes the standard application paths and any paths added by Rails
engines.</p>
<p>Images can also be organized into subdirectories if required, and then can be
accessed by specifying the directory's name in the tag:</p>
<pre><code class="hljs css language-erb"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> image_tag <span class="hljs-string">"icons/rails.png"</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
</span></code></pre>
<p>WARNING: If you're precompiling your assets (see <a href="#in-production">In Production</a>
below), linking to an asset that does not exist will raise an exception in the
calling page. This includes linking to a blank string. As such, be careful using
<code>image_tag</code> and the other helpers with user-supplied data.</p>
<h4><a class="anchor" aria-hidden="true" id="css-and-erb"></a><a href="#css-and-erb" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CSS and ERB</h4>
<p>The asset pipeline automatically evaluates ERB. This means if you add an
<code>erb</code> extension to a CSS asset (for example, <code>application.css.erb</code>), then
helpers like <code>asset_path</code> are available in your CSS rules:</p>
<pre><code class="hljs css language-css"><span class="hljs-selector-class">.class</span> { <span class="hljs-attribute">background-image</span>: <span class="hljs-built_in">url</span>(&lt;%= asset_path <span class="hljs-string">'image.png'</span> %&gt;) }
</code></pre>
<p>This writes the path to the particular asset being referenced. In this example,
it would make sense to have an image in one of the asset load paths, such as
<code>app/assets/images/image.png</code>, which would be referenced here. If this image is
already available in <code>public/assets</code> as a fingerprinted file, then that path is
referenced.</p>
<p>If you want to use a <a href="https://en.wikipedia.org/wiki/Data_URI_scheme">data URI</a> -
a method of embedding the image data directly into the CSS file - you can use
the <code>asset_data_uri</code> helper.</p>
<pre><code class="hljs css language-css"><span class="hljs-selector-id">#logo</span> { <span class="hljs-attribute">background</span>: <span class="hljs-built_in">url</span>(&lt;%= asset_data_uri <span class="hljs-string">'logo.png'</span> %&gt;) }
</code></pre>
<p>This inserts a correctly-formatted data URI into the CSS source.</p>
<p>Note that the closing tag cannot be of the style <code>-%&gt;</code>.</p>
<h4><a class="anchor" aria-hidden="true" id="css-and-sass"></a><a href="#css-and-sass" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CSS and Sass</h4>
<p>When using the asset pipeline, paths to assets must be re-written and
<code>sass-rails</code> provides <code>-url</code> and <code>-path</code> helpers (hyphenated in Sass,
underscored in Ruby) for the following asset classes: image, font, video, audio,
JavaScript and stylesheet.</p>
<ul>
<li><code>image-url(&quot;rails.png&quot;)</code> returns <code>url(/assets/rails.png)</code></li>
<li><code>image-path(&quot;rails.png&quot;)</code> returns <code>&quot;/assets/rails.png&quot;</code></li>
</ul>
<p>The more generic form can also be used:</p>
<ul>
<li><code>asset-url(&quot;rails.png&quot;)</code> returns <code>url(/assets/rails.png)</code></li>
<li><code>asset-path(&quot;rails.png&quot;)</code> returns <code>&quot;/assets/rails.png&quot;</code></li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="javascript-coffeescript-and-erb"></a><a href="#javascript-coffeescript-and-erb" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JavaScript/CoffeeScript and ERB</h4>
<p>If you add an <code>erb</code> extension to a JavaScript asset, making it something such as
<code>application.js.erb</code>, you can then use the <code>asset_path</code> helper in your
JavaScript code:</p>
<pre><code class="hljs css language-js">$(<span class="hljs-string">'#logo'</span>).attr({ <span class="hljs-attr">src</span>: <span class="hljs-string">"&lt;%= asset_path('logo.png') %&gt;"</span> });
</code></pre>
<p>This writes the path to the particular asset being referenced.</p>
<p>Similarly, you can use the <code>asset_path</code> helper in CoffeeScript files with <code>erb</code>
extension (e.g., <code>application.coffee.erb</code>):</p>
<pre><code class="hljs css language-js">$(<span class="hljs-string">'#logo'</span>).attr src: <span class="hljs-string">"&lt;%= asset_path('logo.png') %&gt;"</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="manifest-files-and-directives"></a><a href="#manifest-files-and-directives" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Manifest Files and Directives</h3>
<p>Sprockets uses manifest files to determine which assets to include and serve.
These manifest files contain <em>directives</em> - instructions that tell Sprockets
which files to require in order to build a single CSS or JavaScript file. With
these directives, Sprockets loads the files specified, processes them if
necessary, concatenates them into one single file, and then compresses them
(based on value of <code>Rails.application.config.assets.js_compressor</code>). By serving
one file rather than many, the load time of pages can be greatly reduced because
the browser makes fewer requests. Compression also reduces file size, enabling
the browser to download them faster.</p>
<p>For example, with a <code>app/assets/javascripts/application.js</code> file containing the
following lines:</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// ...</span>
<span class="hljs-comment">//= require rails-ujs</span>
<span class="hljs-comment">//= require turbolinks</span>
<span class="hljs-comment">//= require_tree .</span>
</code></pre>
<p>In JavaScript files, Sprockets directives begin with <code>//=</code>. In the above case,
the file is using the <code>require</code> and the <code>require_tree</code> directives. The <code>require</code>
directive is used to tell Sprockets the files you wish to require. Here, you are
requiring the files <code>rails-ujs.js</code> and <code>turbolinks.js</code> that are available somewhere
in the search path for Sprockets. You need not supply the extensions explicitly.
Sprockets assumes you are requiring a <code>.js</code> file when done from within a <code>.js</code>
file.</p>
<p>The <code>require_tree</code> directive tells Sprockets to recursively include <em>all</em>
JavaScript files in the specified directory into the output. These paths must be
specified relative to the manifest file. You can also use the
<code>require_directory</code> directive which includes all JavaScript files only in the
directory specified, without recursion.</p>
<p>Directives are processed top to bottom, but the order in which files are
included by <code>require_tree</code> is unspecified. You should not rely on any particular
order among those. If you need to ensure some particular JavaScript ends up
above some other in the concatenated file, require the prerequisite file first
in the manifest. Note that the family of <code>require</code> directives prevents files
from being included twice in the output.</p>
<p>Rails also creates a default <code>app/assets/stylesheets/application.css</code> file
which contains these lines:</p>
<pre><code class="hljs css language-css"><span class="hljs-comment">/* ...
*= require_self
*= require_tree .
*/</span>
</code></pre>
<p>Rails create <code>app/assets/stylesheets/application.css</code> regardless of whether the
--skip-sprockets option is used when creating a new Rails application. This is
so you can easily add asset pipelining later if you like.</p>
<p>The directives that work in JavaScript files also work in stylesheets
(though obviously including stylesheets rather than JavaScript files). The
<code>require_tree</code> directive in a CSS manifest works the same way as the JavaScript
one, requiring all stylesheets from the current directory.</p>
<p>In this example, <code>require_self</code> is used. This puts the CSS contained within the
file (if any) at the precise location of the <code>require_self</code> call.</p>
<p>NOTE. If you want to use multiple Sass files, you should generally use the <a href="https://sass-lang.com/docs/yardoc/file.SASS_REFERENCE.html#import">Sass <code>@import</code> rule</a>
instead of these Sprockets directives. When using Sprockets directives, Sass files exist within
their own scope, making variables or mixins only available within the document they were defined in.</p>
<p>You can do file globbing as well using <code>@import &quot;*&quot;</code>, and <code>@import &quot;**/*&quot;</code> to add the whole tree which is equivalent to how <code>require_tree</code> works. Check the <a href="https://github.com/rails/sass-rails#features">sass-rails documentation</a> for more info and important caveats.</p>
<p>You can have as many manifest files as you need. For example, the <code>admin.css</code>
and <code>admin.js</code> manifest could contain the JS and CSS files that are used for the
admin section of an application.</p>
<p>The same remarks about ordering made above apply. In particular, you can specify
individual files and they are compiled in the order specified. For example, you
might concatenate three CSS files together this way:</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">/* ...
*= require reset
*= require layout
*= require chrome
*/</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="preprocessing"></a><a href="#preprocessing" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Preprocessing</h3>
<p>The file extensions used on an asset determine what preprocessing is applied.
When a controller or a scaffold is generated with the default Rails gemset, a
CoffeeScript file and a SCSS file are generated in place of a regular JavaScript
and CSS file. The example used before was a controller called &quot;projects&quot;, which
generated an <code>app/assets/stylesheets/projects.scss</code> file.</p>
<p>In development mode, or if the asset pipeline is disabled, when these files are
requested they are processed by the processors provided by the <code>coffee-script</code>
and <code>sass</code> gems and then sent back to the browser as JavaScript and CSS
respectively. When asset pipelining is enabled, these files are preprocessed and
placed in the <code>public/assets</code> directory for serving by either the Rails app or
web server.</p>
<p>Additional layers of preprocessing can be requested by adding other extensions,
where each extension is processed in a right-to-left manner. These should be
used in the order the processing should be applied. For example, a stylesheet
called <code>app/assets/stylesheets/projects.scss.erb</code> is first processed as ERB,
then SCSS, and finally served as CSS. The same applies to a JavaScript file -
<code>app/assets/javascripts/projects.coffee.erb</code> is processed as ERB, then
CoffeeScript, and served as JavaScript.</p>
<p>Keep in mind the order of these preprocessors is important. For example, if
you called your JavaScript file <code>app/assets/javascripts/projects.erb.coffee</code>
then it would be processed with the CoffeeScript interpreter first, which
wouldn't understand ERB and therefore you would run into problems.</p>
<h2><a class="anchor" aria-hidden="true" id="in-development"></a><a href="#in-development" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>In Development</h2>
<p>In development mode, assets are served as separate files in the order they are
specified in the manifest file.</p>
<p>This manifest <code>app/assets/javascripts/application.js</code>:</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">//= require core</span>
<span class="hljs-comment">//= require projects</span>
<span class="hljs-comment">//= require tickets</span>
</code></pre>
<p>would generate this HTML:</p>
<pre><code class="hljs css language-html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/assets/core.js?body=1"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/assets/projects.js?body=1"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/assets/tickets.js?body=1"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>The <code>body</code> param is required by Sprockets.</p>
<h3><a class="anchor" aria-hidden="true" id="raise-an-error-when-an-asset-is-not-found"></a><a href="#raise-an-error-when-an-asset-is-not-found" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Raise an Error When an Asset is Not Found</h3>
<p>If you are using sprockets-rails &gt;= 3.2.0 you can configure what happens
when an asset lookup is performed and nothing is found. If you turn off &quot;asset fallback&quot;
then an error will be raised when an asset cannot be found.</p>
<pre><code class="hljs css language-ruby">config.assets.unknown_asset_fallback = <span class="hljs-literal">false</span>
</code></pre>
<p>If &quot;asset fallback&quot; is enabled then when an asset cannot be found the path will be
output instead and no error raised. The asset fallback behavior is enabled by default.</p>
<h3><a class="anchor" aria-hidden="true" id="turning-digests-off"></a><a href="#turning-digests-off" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Turning Digests Off</h3>
<p>You can turn off digests by updating <code>config/environments/development.rb</code> to
include:</p>
<pre><code class="hljs css language-ruby">config.assets.digest = <span class="hljs-literal">false</span>
</code></pre>
<p>When this option is true, digests will be generated for asset URLs.</p>
<h3><a class="anchor" aria-hidden="true" id="turning-debugging-off"></a><a href="#turning-debugging-off" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Turning Debugging Off</h3>
<p>You can turn off debug mode by updating <code>config/environments/development.rb</code> to
include:</p>
<pre><code class="hljs css language-ruby">config.assets.debug = <span class="hljs-literal">false</span>
</code></pre>
<p>When debug mode is off, Sprockets concatenates and runs the necessary
preprocessors on all files. With debug mode turned off the manifest above would
generate instead:</p>
<pre><code class="hljs css language-html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/assets/application.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>Assets are compiled and cached on the first request after the server is started.
Sprockets sets a <code>must-revalidate</code> Cache-Control HTTP header to reduce request
overhead on subsequent requests - on these the browser gets a 304 (Not Modified)
response.</p>
<p>If any of the files in the manifest have changed between requests, the server
responds with a new compiled file.</p>
<p>Debug mode can also be enabled in Rails helper methods:</p>
<pre><code class="hljs css language-erb"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> stylesheet_link_tag <span class="hljs-string">"application"</span>, <span class="hljs-symbol">debug:</span> <span class="hljs-literal">true</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> javascript_include_tag <span class="hljs-string">"application"</span>, <span class="hljs-symbol">debug:</span> <span class="hljs-literal">true</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
</span></code></pre>
<p>The <code>:debug</code> option is redundant if debug mode is already on.</p>
<p>You can also enable compression in development mode as a sanity check, and
disable it on-demand as required for debugging.</p>
<h2><a class="anchor" aria-hidden="true" id="in-production"></a><a href="#in-production" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>In Production</h2>
<p>In the production environment Sprockets uses the fingerprinting scheme outlined
above. By default Rails assumes assets have been precompiled and will be
served as static assets by your web server.</p>
<p>During the precompilation phase an SHA256 is generated from the contents of the
compiled files, and inserted into the filenames as they are written to disk.
These fingerprinted names are used by the Rails helpers in place of the manifest
name.</p>
<p>For example this:</p>
<pre><code class="hljs css language-erb"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> javascript_include_tag <span class="hljs-string">"application"</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> stylesheet_link_tag <span class="hljs-string">"application"</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
</span></code></pre>
<p>generates something like this:</p>
<pre><code class="hljs css language-html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/assets/application-908e25f4bf641868d8683022a5b62f54.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/assets/application-4dd5b109ee3439da54f5bdfd78a80473.css"</span> <span class="hljs-attr">media</span>=<span class="hljs-string">"screen"</span>
<span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> /&gt;</span>
</code></pre>
<p>NOTE: with the Asset Pipeline the <code>:cache</code> and <code>:concat</code> options aren't used
anymore, delete these options from the <code>javascript_include_tag</code> and
<code>stylesheet_link_tag</code>.</p>
<p>The fingerprinting behavior is controlled by the <code>config.assets.digest</code>
initialization option (which defaults to <code>true</code>).</p>
<p>NOTE: Under normal circumstances the default <code>config.assets.digest</code> option
should not be changed. If there are no digests in the filenames, and far-future
headers are set, remote clients will never know to refetch the files when their
content changes.</p>
<h3><a class="anchor" aria-hidden="true" id="precompiling-assets"></a><a href="#precompiling-assets" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Precompiling Assets</h3>
<p>Rails comes bundled with a command to compile the asset manifests and other
files in the pipeline.</p>
<p>Compiled assets are written to the location specified in <code>config.assets.prefix</code>.
By default, this is the <code>/assets</code> directory.</p>
<p>You can call this command on the server during deployment to create compiled
versions of your assets directly on the server. See the next section for
information on compiling locally.</p>
<p>The command is:</p>
<pre><code class="hljs css language-bash">$ RAILS_ENV=production rails assets:precompile
</code></pre>
<p>Capistrano (v2.15.1 and above) includes a recipe to handle this in deployment.
Add the following line to <code>Capfile</code>:</p>
<pre><code class="hljs css language-ruby">load <span class="hljs-string">'deploy/assets'</span>
</code></pre>
<p>This links the folder specified in <code>config.assets.prefix</code> to <code>shared/assets</code>.
If you already use this shared folder you'll need to write your own deployment
command.</p>
<p>It is important that this folder is shared between deployments so that remotely
cached pages referencing the old compiled assets still work for the life of
the cached page.</p>
<p>The default matcher for compiling files includes <code>application.js</code>,
<code>application.css</code> and all non-JS/CSS files (this will include all image assets
automatically) from <code>app/assets</code> folders including your gems:</p>
<pre><code class="hljs css language-ruby">[ Proc.new { <span class="hljs-params">|filename, path|</span> path =~ <span class="hljs-regexp">/app\/assets/</span> &amp;&amp; !<span class="hljs-string">%w(.js .css)</span>.<span class="hljs-keyword">include</span>?(File.extname(filename)) },
<span class="hljs-regexp">/application.(css|js)$/</span> ]
</code></pre>
<p>NOTE: The matcher (and other members of the precompile array; see below) is
applied to final compiled file names. This means anything that compiles to
JS/CSS is excluded, as well as raw JS/CSS files; for example, <code>.coffee</code> and
<code>.scss</code> files are <strong>not</strong> automatically included as they compile to JS/CSS.</p>
<p>If you have other manifests or individual stylesheets and JavaScript files to
include, you can add them to the <code>precompile</code> array in <code>config/initializers/assets.rb</code>:</p>
<pre><code class="hljs css language-ruby">Rails.application.config.assets.precompile += <span class="hljs-string">%w( admin.js admin.css )</span>
</code></pre>
<p>NOTE. Always specify an expected compiled filename that ends with <code>.js</code> or <code>.css</code>,
even if you want to add Sass or CoffeeScript files to the precompile array.</p>
<p>The command also generates a <code>.sprockets-manifest-randomhex.json</code> (where <code>randomhex</code> is
a 16-byte random hex string) that contains a list with all your assets and their respective
fingerprints. This is used by the Rails helper methods to avoid handing the
mapping requests back to Sprockets. A typical manifest file looks like:</p>
<pre><code class="hljs css language-ruby">{<span class="hljs-string">"files"</span><span class="hljs-symbol">:</span>{<span class="hljs-string">"application-aee4be71f1288037ae78b997df388332edfd246471b533dcedaa8f9fe156442b.js"</span><span class="hljs-symbol">:</span>{<span class="hljs-string">"logical_path"</span><span class="hljs-symbol">:<span class="hljs-string">"application.js"</span></span>,<span class="hljs-string">"mtime"</span><span class="hljs-symbol">:<span class="hljs-string">"2016-12-23T20:12:03-05:00"</span></span>,<span class="hljs-string">"size"</span><span class="hljs-symbol">:</span><span class="hljs-number">412383</span>,
<span class="hljs-string">"digest"</span><span class="hljs-symbol">:<span class="hljs-string">"aee4be71f1288037ae78b997df388332edfd246471b533dcedaa8f9fe156442b"</span></span>,<span class="hljs-string">"integrity"</span><span class="hljs-symbol">:<span class="hljs-string">"sha256-ruS+cfEogDeueLmX3ziDMu39JGRxtTPc7aqPn+FWRCs="</span></span>},
<span class="hljs-string">"application-86a292b5070793c37e2c0e5f39f73bb387644eaeada7f96e6fc040a028b16c18.css"</span><span class="hljs-symbol">:</span>{<span class="hljs-string">"logical_path"</span><span class="hljs-symbol">:<span class="hljs-string">"application.css"</span></span>,<span class="hljs-string">"mtime"</span><span class="hljs-symbol">:<span class="hljs-string">"2016-12-23T19:12:20-05:00"</span></span>,<span class="hljs-string">"size"</span><span class="hljs-symbol">:</span><span class="hljs-number">2994</span>,
<span class="hljs-string">"digest"</span><span class="hljs-symbol">:<span class="hljs-string">"86a292b5070793c37e2c0e5f39f73bb387644eaeada7f96e6fc040a028b16c18"</span></span>,<span class="hljs-string">"integrity"</span><span class="hljs-symbol">:<span class="hljs-string">"sha256-hqKStQcHk8N+LA5fOfc7s4dkTq6tp/lub8BAoCixbBg="</span></span>},
<span class="hljs-string">"favicon-8d2387b8d4d32cecd93fa3900df0e9ff89d01aacd84f50e780c17c9f6b3d0eda.ico"</span><span class="hljs-symbol">:</span>{<span class="hljs-string">"logical_path"</span><span class="hljs-symbol">:<span class="hljs-string">"favicon.ico"</span></span>,<span class="hljs-string">"mtime"</span><span class="hljs-symbol">:<span class="hljs-string">"2016-12-23T20:11:00-05:00"</span></span>,<span class="hljs-string">"size"</span><span class="hljs-symbol">:</span><span class="hljs-number">8629</span>,
<span class="hljs-string">"digest"</span><span class="hljs-symbol">:<span class="hljs-string">"8d2387b8d4d32cecd93fa3900df0e9ff89d01aacd84f50e780c17c9f6b3d0eda"</span></span>,<span class="hljs-string">"integrity"</span><span class="hljs-symbol">:<span class="hljs-string">"sha256-jSOHuNTTLOzZP6OQDfDp/4nQGqzYT1DngMF8n2s9Dto="</span></span>},
<span class="hljs-string">"my_image-f4028156fd7eca03584d5f2fc0470df1e0dbc7369eaae638b2ff033f988ec493.png"</span><span class="hljs-symbol">:</span>{<span class="hljs-string">"logical_path"</span><span class="hljs-symbol">:<span class="hljs-string">"my_image.png"</span></span>,<span class="hljs-string">"mtime"</span><span class="hljs-symbol">:<span class="hljs-string">"2016-12-23T20:10:54-05:00"</span></span>,<span class="hljs-string">"size"</span><span class="hljs-symbol">:</span><span class="hljs-number">23414</span>,
<span class="hljs-string">"digest"</span><span class="hljs-symbol">:<span class="hljs-string">"f4028156fd7eca03584d5f2fc0470df1e0dbc7369eaae638b2ff033f988ec493"</span></span>,<span class="hljs-string">"integrity"</span><span class="hljs-symbol">:<span class="hljs-string">"sha256-9AKBVv1+ygNYTV8vwEcN8eDbxzaequY4sv8DP5iOxJM="</span></span>}},
<span class="hljs-string">"assets"</span><span class="hljs-symbol">:</span>{<span class="hljs-string">"application.js"</span><span class="hljs-symbol">:<span class="hljs-string">"application-aee4be71f1288037ae78b997df388332edfd246471b533dcedaa8f9fe156442b.js"</span></span>,
<span class="hljs-string">"application.css"</span><span class="hljs-symbol">:<span class="hljs-string">"application-86a292b5070793c37e2c0e5f39f73bb387644eaeada7f96e6fc040a028b16c18.css"</span></span>,
<span class="hljs-string">"favicon.ico"</span><span class="hljs-symbol">:<span class="hljs-string">"favicon-8d2387b8d4d32cecd93fa3900df0e9ff89d01aacd84f50e780c17c9f6b3d0eda.ico"</span></span>,
<span class="hljs-string">"my_image.png"</span><span class="hljs-symbol">:<span class="hljs-string">"my_image-f4028156fd7eca03584d5f2fc0470df1e0dbc7369eaae638b2ff033f988ec493.png"</span></span>}}
</code></pre>
<p>The default location for the manifest is the root of the location specified in
<code>config.assets.prefix</code> ('/assets' by default).</p>
<p>NOTE: If there are missing precompiled files in production you will get a
<code>Sprockets::Helpers::RailsHelper::AssetPaths::AssetNotPrecompiledError</code>
exception indicating the name of the missing file(s).</p>
<h4><a class="anchor" aria-hidden="true" id="far-future-expires-header"></a><a href="#far-future-expires-header" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Far-future Expires Header</h4>
<p>Precompiled assets exist on the file system and are served directly by your web
server. They do not have far-future headers by default, so to get the benefit of
fingerprinting you'll have to update your server configuration to add those
headers.</p>
<p>For Apache:</p>
<pre><code class="hljs css language-apache"><span class="hljs-comment"># The Expires* directives requires the Apache module</span>
<span class="hljs-comment"># `mod_expires` to be enabled.</span>
<span class="hljs-section">&lt;Location /assets/&gt;</span>
  <span class="hljs-comment"># Use of ETag is discouraged when Last-Modified is present</span>
  <span class="hljs-attribute"><span class="hljs-nomarkup">Header</span></span> unset ETag
  <span class="hljs-attribute">FileETag</span> None
  <span class="hljs-comment"># RFC says only cache for 1 year</span>
  <span class="hljs-attribute">ExpiresActive</span> <span class="hljs-literal">On</span>
  <span class="hljs-attribute">ExpiresDefault</span> <span class="hljs-string">"access plus 1 year"</span>
<span class="hljs-section">&lt;/Location&gt;</span>
</code></pre>
<p>For NGINX:</p>
<pre><code class="hljs css language-nginx"><span class="hljs-attribute">location</span> <span class="hljs-regexp">~ ^/assets/</span> {
  <span class="hljs-attribute">expires</span> <span class="hljs-number">1y</span>;
  <span class="hljs-attribute">add_header</span> Cache-Control public;

  <span class="hljs-attribute">add_header</span> ETag <span class="hljs-string">""</span>;
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="local-precompilation"></a><a href="#local-precompilation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Local Precompilation</h3>
<p>There are several reasons why you might want to precompile your assets locally.
Among them are:</p>
<ul>
<li>You may not have write access to your production file system.</li>
<li>You may be deploying to more than one server, and want to avoid
duplication of work.</li>
<li>You may be doing frequent deploys that do not include asset changes.</li>
</ul>
<p>Local compilation allows you to commit the compiled files into source control,
and deploy as normal.</p>
<p>There are three caveats:</p>
<ul>
<li>You must not run the Capistrano deployment task that precompiles assets.</li>
<li>You must ensure any necessary compressors or minifiers are
available on your development system.</li>
<li>You must change the following application configuration setting:</li>
</ul>
<p>In <code>config/environments/development.rb</code>, place the following line:</p>
<pre><code class="hljs css language-ruby">config.assets.prefix = <span class="hljs-string">"/dev-assets"</span>
</code></pre>
<p>The <code>prefix</code> change makes Sprockets use a different URL for serving assets in
development mode, and pass all requests to Sprockets. The prefix is still set to
<code>/assets</code> in the production environment. Without this change, the application
would serve the precompiled assets from <code>/assets</code> in development, and you would
not see any local changes until you compile assets again.</p>
<p>In practice, this will allow you to precompile locally, have those files in your
working tree, and commit those files to source control when needed.  Development
mode will work as expected.</p>
<h3><a class="anchor" aria-hidden="true" id="live-compilation"></a><a href="#live-compilation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Live Compilation</h3>
<p>In some circumstances you may wish to use live compilation. In this mode all
requests for assets in the pipeline are handled by Sprockets directly.</p>
<p>To enable this option set:</p>
<pre><code class="hljs css language-ruby">config.assets.compile = <span class="hljs-literal">true</span>
</code></pre>
<p>On the first request the assets are compiled and cached as outlined in
development above, and the manifest names used in the helpers are altered to
include the SHA256 hash.</p>
<p>Sprockets also sets the <code>Cache-Control</code> HTTP header to <code>max-age=31536000</code>. This
signals all caches between your server and the client browser that this content
(the file served) can be cached for 1 year. The effect of this is to reduce the
number of requests for this asset from your server; the asset has a good chance
of being in the local browser cache or some intermediate cache.</p>
<p>This mode uses more memory, performs more poorly than the default, and is not
recommended.</p>
<p>If you are deploying a production application to a system without any
pre-existing JavaScript runtimes, you may want to add one to your <code>Gemfile</code>:</p>
<pre><code class="hljs css language-ruby">group <span class="hljs-symbol">:production</span> <span class="hljs-keyword">do</span>
  gem <span class="hljs-string">'mini_racer'</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="cdns"></a><a href="#cdns" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CDNs</h3>
<p>CDN stands for <a href="https://en.wikipedia.org/wiki/Content_delivery_network">Content Delivery
Network</a>, they are
primarily designed to cache assets all over the world so that when a browser
requests the asset, a cached copy will be geographically close to that browser.
If you are serving assets directly from your Rails server in production, the
best practice is to use a CDN in front of your application.</p>
<p>A common pattern for using a CDN is to set your production application as the
&quot;origin&quot; server. This means when a browser requests an asset from the CDN and
there is a cache miss, it will grab the file from your server on the fly and
then cache it. For example if you are running a Rails application on
<code>example.com</code> and have a CDN configured at <code>mycdnsubdomain.fictional-cdn.com</code>,
then when a request is made to <code>mycdnsubdomain.fictional- cdn.com/assets/smile.png</code>, the CDN will query your server once at
<code>example.com/assets/smile.png</code> and cache the request. The next request to the
CDN that comes in to the same URL will hit the cached copy. When the CDN can
serve an asset directly the request never touches your Rails server. Since the
assets from a CDN are geographically closer to the browser, the request is
faster, and since your server doesn't need to spend time serving assets, it can
focus on serving application code as fast as possible.</p>
<h4><a class="anchor" aria-hidden="true" id="set-up-a-cdn-to-serve-static-assets"></a><a href="#set-up-a-cdn-to-serve-static-assets" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Set up a CDN to Serve Static Assets</h4>
<p>To set up your CDN you have to have your application running in production on
the internet at a publicly available URL, for example <code>example.com</code>. Next
you'll need to sign up for a CDN service from a cloud hosting provider. When you
do this you need to configure the &quot;origin&quot; of the CDN to point back at your
website <code>example.com</code>, check your provider for documentation on configuring the
origin server.</p>
<p>The CDN you provisioned should give you a custom subdomain for your application
such as <code>mycdnsubdomain.fictional-cdn.com</code> (note fictional-cdn.com is not a
valid CDN provider at the time of this writing). Now that you have configured
your CDN server, you need to tell browsers to use your CDN to grab assets
instead of your Rails server directly. You can do this by configuring Rails to
set your CDN as the asset host instead of using a relative path. To set your
asset host in Rails, you need to set <code>config.action_controller.asset_host</code> in
<code>config/environments/production.rb</code>:</p>
<pre><code class="hljs css language-ruby">config.action_controller.asset_host = <span class="hljs-string">'mycdnsubdomain.fictional-cdn.com'</span>
</code></pre>
<p>NOTE: You only need to provide the &quot;host&quot;, this is the subdomain and root
domain, you do not need to specify a protocol or &quot;scheme&quot; such as <code>http://</code> or
<code>https://</code>. When a web page is requested, the protocol in the link to your asset
that is generated will match how the webpage is accessed by default.</p>
<p>You can also set this value through an <a href="https://en.wikipedia.org/wiki/Environment_variable">environment
variable</a> to make running a
staging copy of your site easier:</p>
<pre><code class="hljs">config<span class="hljs-selector-class">.action_controller</span><span class="hljs-selector-class">.asset_host</span> = ENV[<span class="hljs-string">'CDN_HOST'</span>]
</code></pre>
<p>NOTE: You would need to set <code>CDN_HOST</code> on your server to <code>mycdnsubdomain .fictional-cdn.com</code> for this to work.</p>
<p>Once you have configured your server and your CDN when you serve a webpage that
has an asset:</p>
<pre><code class="hljs css language-erb"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> asset_path(<span class="hljs-string">'smile.png'</span>) </span><span class="xml"><span class="hljs-tag">%&gt;</span>
</span></code></pre>
<p>Instead of returning a path such as <code>/assets/smile.png</code> (digests are left out
for readability). The URL generated will have the full path to your CDN.</p>
<pre><code class="hljs">http:<span class="hljs-regexp">//my</span>cdnsubdomain.fictional-cdn.com<span class="hljs-regexp">/assets/</span>smile.png
</code></pre>
<p>If the CDN has a copy of <code>smile.png</code> it will serve it to the browser and your
server doesn't even know it was requested. If the CDN does not have a copy it
will try to find it at the &quot;origin&quot; <code>example.com/assets/smile.png</code> and then store
it for future use.</p>
<p>If you want to serve only some assets from your CDN, you can use custom <code>:host</code>
option your asset helper, which overwrites value set in
<code>config.action_controller.asset_host</code>.</p>
<pre><code class="hljs css language-erb"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> asset_path <span class="hljs-string">'image.png'</span>, <span class="hljs-symbol">host:</span> <span class="hljs-string">'mycdnsubdomain.fictional-cdn.com'</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span>
</span></code></pre>
<h4><a class="anchor" aria-hidden="true" id="customize-cdn-caching-behavior"></a><a href="#customize-cdn-caching-behavior" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Customize CDN Caching Behavior</h4>
<p>A CDN works by caching content. If the CDN has stale or bad content, then it is
hurting rather than helping your application. The purpose of this section is to
describe general caching behavior of most CDNs, your specific provider may
behave slightly differently.</p>
<h5><a class="anchor" aria-hidden="true" id="cdn-request-caching"></a><a href="#cdn-request-caching" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CDN Request Caching</h5>
<p>While a CDN is described as being good for caching assets, in reality caches the
entire request. This includes the body of the asset as well as any headers. The
most important one being <code>Cache-Control</code> which tells the CDN (and web browsers)
how to cache contents. This means that if someone requests an asset that does
not exist <code>/assets/i-dont-exist.png</code> and your Rails application returns a 404,
then your CDN will likely cache the 404 page if a valid <code>Cache-Control</code> header
is present.</p>
<h5><a class="anchor" aria-hidden="true" id="cdn-header-debugging"></a><a href="#cdn-header-debugging" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CDN Header Debugging</h5>
<p>One way to check the headers are cached properly in your CDN is by using <a href="https://explainshell.com/explain?cmd=curl+-I+http%3A%2F%2Fwww.example.com">curl</a>. You
can request the headers from both your server and your CDN to verify they are
the same:</p>
<pre><code class="hljs">$ curl -I http:<span class="hljs-comment">//www.example/assets/application-</span>
d0e099e021c95eb0de3615fd1d8c4d83.css
HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span> OK
Server: Cowboy
Date: Sun, <span class="hljs-number">24</span> Aug <span class="hljs-number">2014</span> <span class="hljs-number">20</span>:<span class="hljs-number">27</span>:<span class="hljs-number">50</span> GMT
Connection: keep-alive
Last-Modified: Thu, <span class="hljs-number">08</span> May <span class="hljs-number">2014</span> <span class="hljs-number">01</span>:<span class="hljs-number">24</span>:<span class="hljs-number">14</span> GMT
Content-Type: text/css
Cache-Control: <span class="hljs-keyword">public</span>, max-age=<span class="hljs-number">2592000</span>
Content-Length: <span class="hljs-number">126560</span>
Via: <span class="hljs-number">1.1</span> vegur
</code></pre>
<p>Versus the CDN copy.</p>
<pre><code class="hljs">$ curl -I http:<span class="hljs-comment">//mycdnsubdomain.fictional-cdn.com/application-</span>
d0e099e021c95eb0de3615fd1d8c4d83.css
HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span> OK Server: Cowboy Last-
Modified: Thu, <span class="hljs-number">08</span> May <span class="hljs-number">2014</span> <span class="hljs-number">01</span>:<span class="hljs-number">24</span>:<span class="hljs-number">14</span> GMT Content-Type: text/css
Cache-Control:
<span class="hljs-keyword">public</span>, max-age=<span class="hljs-number">2592000</span>
Via: <span class="hljs-number">1.1</span> vegur
Content-Length: <span class="hljs-number">126560</span>
Accept-Ranges:
bytes
Date: Sun, <span class="hljs-number">24</span> Aug <span class="hljs-number">2014</span> <span class="hljs-number">20</span>:<span class="hljs-number">28</span>:<span class="hljs-number">45</span> GMT
Via: <span class="hljs-number">1.1</span> varnish
Age: <span class="hljs-number">885814</span>
Connection: keep-alive
X-Served-By: cache-dfw1828-DFW
X-Cache: HIT
X-Cache-Hits:
<span class="hljs-number">68</span>
X-Timer: S1408912125<span class="hljs-number">.211638212</span>,VS0,VE0
</code></pre>
<p>Check your CDN documentation for any additional information they may provide
such as <code>X-Cache</code> or for any additional headers they may add.</p>
<h5><a class="anchor" aria-hidden="true" id="cdns-and-the-cache-control-header"></a><a href="#cdns-and-the-cache-control-header" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CDNs and the Cache-Control Header</h5>
<p>The <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.9">cache control
header</a> is a W3C
specification that describes how a request can be cached. When no CDN is used, a
browser will use this information to cache contents. This is very helpful for
assets that are not modified so that a browser does not need to re-download a
website's CSS or JavaScript on every request. Generally we want our Rails server
to tell our CDN (and browser) that the asset is &quot;public&quot;, that means any cache
can store the request. Also we commonly want to set <code>max-age</code> which is how long
the cache will store the object before invalidating the cache. The <code>max-age</code>
value is set to seconds with a maximum possible value of <code>31536000</code> which is one
year. You can do this in your Rails application by setting</p>
<pre><code class="hljs">config<span class="hljs-selector-class">.public_file_server</span><span class="hljs-selector-class">.headers</span> = {
  <span class="hljs-string">'Cache-Control'</span> =&gt; <span class="hljs-string">'public, max-age=31536000'</span>
}
</code></pre>
<p>Now when your application serves an asset in production, the CDN will store the
asset for up to a year. Since most CDNs also cache headers of the request, this
<code>Cache-Control</code> will be passed along to all future browsers seeking this asset,
the browser then knows that it can store this asset for a very long time before
needing to re-request it.</p>
<h5><a class="anchor" aria-hidden="true" id="cdns-and-url-based-cache-invalidation"></a><a href="#cdns-and-url-based-cache-invalidation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CDNs and URL based Cache Invalidation</h5>
<p>Most CDNs will cache contents of an asset based on the complete URL. This means
that a request to</p>
<pre><code class="hljs">http:<span class="hljs-regexp">//my</span>cdnsubdomain.fictional-cdn.com<span class="hljs-regexp">/assets/</span>smile-<span class="hljs-number">123</span>.png
</code></pre>
<p>Will be a completely different cache from</p>
<pre><code class="hljs">http:<span class="hljs-regexp">//my</span>cdnsubdomain.fictional-cdn.com<span class="hljs-regexp">/assets/</span>smile.png
</code></pre>
<p>If you want to set far future <code>max-age</code> in your <code>Cache-Control</code> (and you do),
then make sure when you change your assets that your cache is invalidated. For
example when changing the smiley face in an image from yellow to blue, you want
all visitors of your site to get the new blue face. When using a CDN with the
Rails asset pipeline <code>config.assets.digest</code> is set to true by default so that
each asset will have a different file name when it is changed. This way you
don't have to ever manually invalidate any items in your cache. By using a
different unique asset name instead, your users get the latest asset.</p>
<h2><a class="anchor" aria-hidden="true" id="customizing-the-pipeline"></a><a href="#customizing-the-pipeline" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Customizing the Pipeline</h2>
<h3><a class="anchor" aria-hidden="true" id="css-compression"></a><a href="#css-compression" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CSS Compression</h3>
<p>One of the options for compressing CSS is YUI. The <a href="https://yui.github.io/yuicompressor/css.html">YUI CSS
compressor</a> provides
minification.</p>
<p>The following line enables YUI compression, and requires the <code>yui-compressor</code>
gem.</p>
<pre><code class="hljs css language-ruby">config.assets.css_compressor = <span class="hljs-symbol">:yui</span>
</code></pre>
<p>The other option for compressing CSS if you have the sass-rails gem installed is</p>
<pre><code class="hljs css language-ruby">config.assets.css_compressor = <span class="hljs-symbol">:sass</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="javascript-compression"></a><a href="#javascript-compression" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JavaScript Compression</h3>
<p>Possible options for JavaScript compression are <code>:closure</code>, <code>:uglifier</code> and
<code>:yui</code>. These require the use of the <code>closure-compiler</code>, <code>uglifier</code> or
<code>yui-compressor</code> gems, respectively.</p>
<p>Take the <code>uglifier</code> gem, for example.
This gem wraps <a href="https://github.com/mishoo/UglifyJS">UglifyJS</a> (written for
NodeJS) in Ruby. It compresses your code by removing white space and comments,
shortening local variable names, and performing other micro-optimizations such
as changing <code>if</code> and <code>else</code> statements to ternary operators where possible.</p>
<p>The following line invokes <code>uglifier</code> for JavaScript compression.</p>
<pre><code class="hljs css language-ruby">config.assets.js_compressor = <span class="hljs-symbol">:uglifier</span>
</code></pre>
<p>NOTE: You will need an <a href="https://github.com/rails/execjs#readme">ExecJS</a>
supported runtime in order to use <code>uglifier</code>. If you are using macOS or
Windows you have a JavaScript runtime installed in your operating system.</p>
<h3><a class="anchor" aria-hidden="true" id="gzipping-your-assets"></a><a href="#gzipping-your-assets" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>GZipping your assets</h3>
<p>By default, gzipped version of compiled assets will be generated, along with
the non-gzipped version of assets. Gzipped assets help reduce the transmission
of data over the wire. You can configure this by setting the <code>gzip</code> flag.</p>
<pre><code class="hljs css language-ruby">config.assets.gzip = <span class="hljs-literal">false</span> <span class="hljs-comment"># disable gzipped assets generation</span>
</code></pre>
<p>Refer to your web server's documentation for instructions on how to serve gzipped assets.</p>
<h3><a class="anchor" aria-hidden="true" id="using-your-own-compressor"></a><a href="#using-your-own-compressor" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using Your Own Compressor</h3>
<p>The compressor config settings for CSS and JavaScript also take any object.
This object must have a <code>compress</code> method that takes a string as the sole
argument and it must return a string.</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Transformer</span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compress</span><span class="hljs-params">(string)</span></span>
    do_something_returning_a_string(string)
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>To enable this, pass a new object to the config option in <code>application.rb</code>:</p>
<pre><code class="hljs css language-ruby">config.assets.css_compressor = Transformer.new
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="changing-the-_assets_-path"></a><a href="#changing-the-_assets_-path" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Changing the <em>assets</em> Path</h3>
<p>The public path that Sprockets uses by default is <code>/assets</code>.</p>
<p>This can be changed to something else:</p>
<pre><code class="hljs css language-ruby">config.assets.prefix = <span class="hljs-string">"/some_other_path"</span>
</code></pre>
<p>This is a handy option if you are updating an older project that didn't use the
asset pipeline and already uses this path or you wish to use this path for
a new resource.</p>
<h3><a class="anchor" aria-hidden="true" id="x-sendfile-headers"></a><a href="#x-sendfile-headers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>X-Sendfile Headers</h3>
<p>The X-Sendfile header is a directive to the web server to ignore the response
from the application, and instead serve a specified file from disk. This option
is off by default, but can be enabled if your server supports it. When enabled,
this passes responsibility for serving the file to the web server, which is
faster. Have a look at <a href="https://api.rubyonrails.org/classes/ActionController/DataStreaming.html#method-i-send_file">send_file</a>
on how to use this feature.</p>
<p>Apache and NGINX support this option, which can be enabled in
<code>config/environments/production.rb</code>:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-comment"># config.action_dispatch.x_sendfile_header = "X-Sendfile" # for Apache</span>
<span class="hljs-comment"># config.action_dispatch.x_sendfile_header = 'X-Accel-Redirect' # for NGINX</span>
</code></pre>
<p>WARNING: If you are upgrading an existing application and intend to use this
option, take care to paste this configuration option only into <code>production.rb</code>
and any other environments you define with production behavior (not
<code>application.rb</code>).</p>
<p>TIP: For further details have a look at the docs of your production web server:</p>
<ul>
<li><a href="https://tn123.org/mod_xsendfile/">Apache</a></li>
<li><a href="https://www.nginx.com/resources/wiki/start/topics/examples/xsendfile/">NGINX</a></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="assets-cache-store"></a><a href="#assets-cache-store" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Assets Cache Store</h2>
<p>By default, Sprockets caches assets in <code>tmp/cache/assets</code> in development
and production environments. This can be changed as follows:</p>
<pre><code class="hljs css language-ruby">config.assets.configure <span class="hljs-keyword">do</span> <span class="hljs-params">|env|</span>
  env.cache = ActiveSupport::Cache.lookup_store(<span class="hljs-symbol">:memory_store</span>,
                                                { <span class="hljs-symbol">size:</span> <span class="hljs-number">32</span>.megabytes })
<span class="hljs-keyword">end</span>
</code></pre>
<p>To disable the assets cache store:</p>
<pre><code class="hljs css language-ruby">config.assets.configure <span class="hljs-keyword">do</span> <span class="hljs-params">|env|</span>
  env.cache = ActiveSupport::Cache.lookup_store(<span class="hljs-symbol">:null_store</span>)
<span class="hljs-keyword">end</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="adding-assets-to-your-gems"></a><a href="#adding-assets-to-your-gems" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Adding Assets to Your Gems</h2>
<p>Assets can also come from external sources in the form of gems.</p>
<p>A good example of this is the <code>jquery-rails</code> gem.
This gem contains an engine class which inherits from <code>Rails::Engine</code>.
By doing this, Rails is informed that the directory for this
gem may contain assets and the <code>app/assets</code>, <code>lib/assets</code> and
<code>vendor/assets</code> directories of this engine are added to the search path of
Sprockets.</p>
<h2><a class="anchor" aria-hidden="true" id="making-your-library-or-gem-a-pre-processor"></a><a href="#making-your-library-or-gem-a-pre-processor" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Making Your Library or Gem a Pre-Processor</h2>
<p>Sprockets uses Processors, Transformers, Compressors, and Exporters to extend
Sprockets functionality. Have a look at
<a href="https://github.com/rails/sprockets/blob/master/guides/extending_sprockets.md">Extending Sprockets</a>
to learn more. Here we registered a preprocessor to add a comment to the end
of text/css (<code>.css</code>) files.</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">AddComment</span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">self</span>.<span class="hljs-title">call</span><span class="hljs-params">(input)</span></span>
    { <span class="hljs-symbol">data:</span> input[<span class="hljs-symbol">:data</span>] + <span class="hljs-string">"/* Hello From my sprockets extension */"</span> }
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>Now that you have a module that modifies the input data, it's time to register
it as a preprocessor for your mime type.</p>
<pre><code class="hljs css language-ruby">Sprockets.register_preprocessor <span class="hljs-string">'text/css'</span>, AddComment
</code></pre>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 2019-7-7</em></div><div class="docs-prevnext"><a class="docs-prev button" href="/rails-setup/docs/rails/rails-command-line"><span class="arrow-prev">← </span><span>The Rails Command Line</span></a><a class="docs-next button" href="/rails-setup/docs/rails/working-with-javascript"><span class="function-name-prevnext">Working with JavaScript in Rails</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#what-is-the-asset-pipeline">What is the Asset Pipeline?</a><ul class="toc-headings"><li><a href="#main-features">Main Features</a></li><li><a href="#what-is-fingerprinting-and-why-should-i-care">What is Fingerprinting and Why Should I Care?</a></li></ul></li><li><a href="#how-to-use-the-asset-pipeline">How to Use the Asset Pipeline</a><ul class="toc-headings"><li><a href="#controller-specific-assets">Controller Specific Assets</a></li><li><a href="#asset-organization">Asset Organization</a></li><li><a href="#coding-links-to-assets">Coding Links to Assets</a></li><li><a href="#manifest-files-and-directives">Manifest Files and Directives</a></li><li><a href="#preprocessing">Preprocessing</a></li></ul></li><li><a href="#in-development">In Development</a><ul class="toc-headings"><li><a href="#raise-an-error-when-an-asset-is-not-found">Raise an Error When an Asset is Not Found</a></li><li><a href="#turning-digests-off">Turning Digests Off</a></li><li><a href="#turning-debugging-off">Turning Debugging Off</a></li></ul></li><li><a href="#in-production">In Production</a><ul class="toc-headings"><li><a href="#precompiling-assets">Precompiling Assets</a></li><li><a href="#local-precompilation">Local Precompilation</a></li><li><a href="#live-compilation">Live Compilation</a></li><li><a href="#cdns">CDNs</a></li></ul></li><li><a href="#customizing-the-pipeline">Customizing the Pipeline</a><ul class="toc-headings"><li><a href="#css-compression">CSS Compression</a></li><li><a href="#javascript-compression">JavaScript Compression</a></li><li><a href="#gzipping-your-assets">GZipping your assets</a></li><li><a href="#using-your-own-compressor">Using Your Own Compressor</a></li><li><a href="#changing-the-_assets_-path">Changing the <em>assets</em> Path</a></li><li><a href="#x-sendfile-headers">X-Sendfile Headers</a></li></ul></li><li><a href="#assets-cache-store">Assets Cache Store</a></li><li><a href="#adding-assets-to-your-gems">Adding Assets to Your Gems</a></li><li><a href="#making-your-library-or-gem-a-pre-processor">Making Your Library or Gem a Pre-Processor</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="copyright">Rails Setup 2019</section></footer></div></body></html>